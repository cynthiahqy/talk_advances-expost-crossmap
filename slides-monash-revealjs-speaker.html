<!DOCTYPE html>
<html lang="en"><head>
<script src="slides_files/libs/clipboard/clipboard.min.js"></script>
<script src="slides_files/libs/quarto-html/tabby.min.js"></script>
<script src="slides_files/libs/quarto-html/popper.min.js"></script>
<script src="slides_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="slides_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="slides_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="slides_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="slides_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.433">

  <meta name="author" content="Cynthia Huang">
  <title>Advances in Ex-Post Harmonisation using Graph Representations of Cross-Taxonomy Transformations</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="slides_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="slides_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="slides_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="_extensions/numbats/monash/assets/tachyons-addon.css">
  <link rel="stylesheet" href="_extensions/numbats/monash/assets/custom.css">
  <link href="slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="slides_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="slides_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="_extensions/numbats/monash/images/bg-10.png" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Advances in Ex-Post Harmonisation using Graph Representations of Cross-Taxonomy Transformations</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Cynthia Huang 
</div>
<div class="quarto-title-author-email">
<a href="mailto:supervised by Prof.&nbsp;Rob J Hyndman and Dr.&nbsp;Sarah Goodwin">supervised by Prof.&nbsp;Rob J Hyndman and Dr.&nbsp;Sarah Goodwin</a>
</div>
        <p class="quarto-title-affiliation">
            Department of Econometrics and Business Statistics
          </p>
    </div>
</div>

  <p class="date">Oct 10, 2023</p>
</section>
<section id="ex-post-harmonisation" class="slide level2">
<h2>Ex-Post Harmonisation</h2>
<blockquote>
<p>Ex-post (or retrospective) data harmonization refers to procedures applied to already collected data to improve the comparability and inferential equivalence of measures from different studies <span class="citation" data-cites="kolczynska2022 fortierMaelstromResearchguidelines2016 ehlingHarmonisingDataOfficial2003">(<a href="#/references" role="doc-biblioref" onclick="">Kołczyńska 2022</a>; <a href="#/references" role="doc-biblioref" onclick="">Fortier et al. 2016</a>; <a href="#/references" role="doc-biblioref" onclick="">Ehling 2003</a>)</span></p>
</blockquote>
<p>Typical cases in Official Statistics involve different taxonomies across space and/or time:</p>
<ul>
<li><strong>Labour Statistics:</strong> adding and deleting occupation codes</li>
<li><strong>Macroeconomic and Trade Data:</strong> evolving product/industry classifications; changing country boundaries</li>
<li><strong>Census and Election Data:</strong> changing statistical survey or electoral boundaries</li>
</ul>
</section>
<section id="sub-tasks-in-ex-post-harmonisation" class="slide level2">
<h2>Sub-Tasks in Ex-Post Harmonisation</h2>
<p>Ex-post harmonisation involves a number of related data wrangling tasks including selecting approriate transformations, and then implementing and validating them on data.</p>

<img data-src="images/image-137145983.png" class="r-stretch quarto-figure-center"></section>
<section id="cross-taxonomy-transformations" class="slide level2">
<h2>Cross-Taxonomy Transformations</h2>
<p>We use the term <strong>cross-taxonomy transformation</strong> to refer to the sub-task of taking observations collected using a <em>source</em> taxonomy, and transforming it into “counter-factual” observations indexed by a <em>target</em> taxonomy.</p>
<ul>
<li><strong>Source/Target Taxonomy:</strong> a set of categories (e.g.&nbsp;occupation codes, product codes, etc.) according to which data is collected or transformed into.</li>
<li><strong>Category Indexed Values</strong>: a set of (numeric) values indexed by a taxonomy</li>
<li><strong>Observation:</strong> A set of category indexed values for a given unit of observation (e.g.&nbsp;country, year)</li>
</ul>
</section>
<section id="motivation-background-for-new-approach" class="slide level2">
<h2>Motivation &amp; Background for New Approach</h2>
<ul>
<li>Standardised workflows can:
<ul>
<li>improve code readability and reuse, and</li>
<li>reduce errors</li>
<li>see Domain Specfic Languages for data preparation <span class="citation" data-cites="wickhamTidyData2014 kandelWranglerInteractivevisual2011">(<a href="#/references" role="doc-biblioref" onclick="">Wickham 2014</a>; <a href="#/references" role="doc-biblioref" onclick="">Kandel et al. 2011</a>)</span></li>
</ul></li>
<li>Statistical properties of complex data pre-processing are not as well understood or studied compared to simpler transformations (e.g.&nbsp;missing data imputation, outlier detection, etc.)
<ul>
<li>formal structures and frameworks can enable more rigorous anlaysis of these properties</li>
<li>e.g. <span class="citation" data-cites="blockerPotentialPerilsPreprocessing2013">Blocker and Meng (<a href="#/references" role="doc-biblioref" onclick="">2013</a>)</span> propose a theoretical framework for multi-phase inference</li>
</ul></li>
</ul>
</section>
<section id="existing-approaches" class="slide level2">
<h2>Existing Approaches</h2>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>implementations are highly varied and idiosyncratic</li>
<li>auditing &amp; reuse depends on readability of source code</li>
<li>data quality validation is ad-hoc and unlikely to be comprehensive</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/paste-13.png"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="crossmap-approach" class="slide level2">
<h2>Crossmap Approach</h2>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>separates the specification of transformations from their implementation</li>
<li>provides a standardised framework for validation using graph conditions</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/paste-14.png"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="crossmaps-as-conditional-probability-distributions" class="slide level2">
<h2>Crossmaps as Conditional Probability Distributions</h2>
<aside class="notes">
<p><strong>Bi-Partite Graph</strong>: has two disjoint sets of nodes, and edges only connect nodes from different sets.</p>
<p><strong>Conditional Probability Distribution</strong>: describes the probability of an event given the occurrence of another event</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><strong>Bi-Partite Graph</strong>: the source and target taxonomies form two disjoint sets of nodes, and weighted edges specify how numeric data is passed between the two taxonomies.</p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="slides_files/figure-revealjs/unnamed-chunk-2-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="other-useful-representations" class="slide level2">
<h2>Other useful representations</h2>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><strong>Transition Matrix</strong>: representation highlights the fact that cross-taxonomy transformations are a special case of Markov Chains.</p>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="slides_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><strong>Edge List</strong>: representation allows for the transformation to implemented as a series of database joins.</p>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output cell-output-stdout">
<pre><code>xmap_df:
recode, split, and collapse  
(from -&gt; to) BY weights
  from to weights
1    a AA     1.0
2    b AA     1.0
3    c AA     1.0
4    d BB     1.0
5    e CC     1.0
6    f DD     0.3
7    f EE     0.3
8    f FF     0.4</code></pre>
</div>
</div>
</div>
</div>
<!-- ![](images/paste-22.png){fig-align="center"} -->
</section>
<section id="implications-for-validing-transformation-logic" class="slide level2">
<h2>Implications for Validing Transformation Logic</h2>
<ul>
<li>A valid cross-taxonomy transformation should <strong>preserve the total</strong> of category index values in each source observation.</li>
<li>A crossmap has valid transformation logic if every source node and its outgoing links define a valid probability distribution – i.e.&nbsp;<strong>the sum of the edge weights is 1.</strong></li>
<li>Missing values cannot be meaningfully distributed across multiple categories, so missing values should be dealt with before the cross-taxonomy transformation.</li>
</ul>
</section>
<section id="implications-for-code-readability" class="slide level2">
<h2>Implications for Code Readability</h2>
<p>Just THREE lines of R code to transform data using a validated crossmap:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>hssicnaics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"naics_xmap.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>src_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"prod_data.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>final_data <span class="ot">&lt;-</span> <span class="fu">apply_xmap</span>(<span class="at">.data =</span> prod_data, <span class="at">.xmap =</span> hssicnaics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Compared to hundreds for imperative algorithms (e.g.&nbsp;STATA code below):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>hssicnaics_20191205/schott_algorithm_28.do [800+ lines]</strong></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">/*
</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">
</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">HS-SIC-NAICS- Concordance Project
</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">
</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">This program
</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">
</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">	1. reads in the hs-sic and hs-naics concordances from the monthly trade cd files and
</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">         from Census and uses two mechanical matches to fill in naics matches prior to 2000 and sic 
</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">         matches after 2001.
</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">	2. Although step 1 succeeds in generating many matches, there are some that remain unmatched. 
</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">         these were given to an RA (thanks kitjawat!) to match by hand. These hand matches are merged in 
</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">         after the mechanical matches. (Note that one typo in the handmatched file is fixed in this .do file.
</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">	3. In the future, we intend to explore using our hs-over-time concordances to avoid the need for any
</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">         hand-matching. 
</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">
</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">copyright Peter K. Schott / Justin R. Pierce
</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">
</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">This program, associated files and a working paper describing our overall HS-SIC-NAICS concordance effort 
</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">can be found at http://www.som.yale.edu/faculty/pks4/
</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">
</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">2008.08.21 first version
</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">2009.10.16 current version 
</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">2016.7.27  restored the older practice (89-106) of keeping SIC and naics codes as strings
</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">           so, in key place, subbed back in code from v20
</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">		   also updated to use concordances from 89-115
</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">2018.7.16  moved this all to /research/schott_trade_website
</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">		   added the NAICSX codes
</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">
</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">
</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">
</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">*/</span>
</span>
<span id="cb3-32"><a href="#cb3-32"></a>
</span>
<span id="cb3-33"><a href="#cb3-33"></a>
</span>
<span id="cb3-34"><a href="#cb3-34"></a>**0 Prelim
</span>
<span id="cb3-35"><a href="#cb3-35"></a>clear
</span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="kw">set</span> <span class="kw">more</span> off
</span>
<span id="cb3-37"><a href="#cb3-37"></a>
</span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co">/*
</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">global MC "D:\Dropbox (yale som economics)\research\schott_trade_website\hs_sic_naics\input\m_concordance\"</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="co">global XC "D:\Dropbox (yale som economics)\research\schott_trade_website\hs_sic_naics\input\x_concordance\"</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="co">global NC "D:\Dropbox (yale som economics)\research\schott_trade_website\hs_sic_naics\input\naics\"</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="co">global C  "D:\Dropbox (yale som economics)\research\schott_trade_website\hs_sic_naics\"</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="co">global CI  "D:\Dropbox (yale som economics)\research\schott_trade_website\hs_sic_naics\interim"</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="co">*/</span>
</span>
<span id="cb3-45"><a href="#cb3-45"></a>
</span>
<span id="cb3-46"><a href="#cb3-46"></a>
</span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="kw">global</span> MC <span class="st">"/io/jrp_research/schott_trade_website/hs_sic_naics/input/m_concordance/"</span>
</span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="kw">global</span> XC <span class="st">"/io/jrp_research/schott_trade_website/hs_sic_naics/input/x_concordance/"</span>
</span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="kw">global</span> NC <span class="st">"/io/jrp_research/schott_trade_website/hs_sic_naics/input/naics/"</span>
</span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="kw">global</span> C  <span class="st">"/io/jrp_research/schott_trade_website/hs_sic_naics/"</span>
</span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="kw">global</span> CI  <span class="st">"/io/jrp_research/schott_trade_website/hs_sic_naics/interim/"</span>
</span>
<span id="cb3-52"><a href="#cb3-52"></a>
</span>
<span id="cb3-53"><a href="#cb3-53"></a>cd <span class="st">"$C"</span>
</span>
<span id="cb3-54"><a href="#cb3-54"></a>
</span>
<span id="cb3-55"><a href="#cb3-55"></a>
</span>
<span id="cb3-56"><a href="#cb3-56"></a>
</span>
<span id="cb3-57"><a href="#cb3-57"></a>
</span>
<span id="cb3-58"><a href="#cb3-58"></a>*0 prep <span class="kw">new</span> (<span class="kw">post</span> 2016) concordances
</span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="co">/*
</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="co">foreach y in "16" "17" {
</span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="co">	foreach m in "12" /*"01" "02" "03" "04" "05" "06" "07" "08" "09" "10" "11" "12"*/</span> {
</span>
<span id="cb3-62"><a href="#cb3-62"></a>	
</span>
<span id="cb3-63"><a href="#cb3-63"></a>		cd <span class="kw">d</span>:\<span class="kw">data</span>\raw_yale_trade\monthly
</span>
<span id="cb3-64"><a href="#cb3-64"></a>		unzipfile EXDB<span class="ot">`y'`m'</span>, replace
</span>
<span id="cb3-65"><a href="#cb3-65"></a>
</span>
<span id="cb3-66"><a href="#cb3-66"></a>		infix <span class="co">///
</span></span>
<span id="cb3-67"><a href="#cb3-67"></a>			<span class="kw">double</span> commodity 	1-10 <span class="co">///
</span></span>
<span id="cb3-68"><a href="#cb3-68"></a>			str descrip_1 		11-160 <span class="co">///
</span></span>
<span id="cb3-69"><a href="#cb3-69"></a>			str descrip_2 		161-210 <span class="co">///
</span></span>
<span id="cb3-70"><a href="#cb3-70"></a>			str quantity_1 		211-213 <span class="co">///
</span></span>
<span id="cb3-71"><a href="#cb3-71"></a>			str quantity_2 		214-216 <span class="co">///
</span></span>
<span id="cb3-72"><a href="#cb3-72"></a>			<span class="kw">double</span> sitc 		217-221 <span class="co">///
</span></span>
<span id="cb3-73"><a href="#cb3-73"></a>			<span class="kw">double</span> end_use 		222-226 <span class="co">///
</span></span>
<span id="cb3-74"><a href="#cb3-74"></a>			str naics			227-232 <span class="co">///
</span></span>
<span id="cb3-75"><a href="#cb3-75"></a>			usda				233-233 <span class="co">///
</span></span>
<span id="cb3-76"><a href="#cb3-76"></a>			hitech				234-235 <span class="co">///
</span></span>
<span id="cb3-77"><a href="#cb3-77"></a>		<span class="kw">using</span> CONCORD.TXT, clear
</span>
<span id="cb3-78"><a href="#cb3-78"></a>		
</span>
<span id="cb3-79"><a href="#cb3-79"></a>		<span class="kw">label</span> <span class="kw">var</span> commodity 	<span class="st">"10-Digit Harmonized Tariff Schedule (HTS) Code"</span>
</span>
<span id="cb3-80"><a href="#cb3-80"></a>		<span class="kw">label</span> <span class="kw">var</span> descrip_1		<span class="st">"150 digit description"</span>
</span>
<span id="cb3-81"><a href="#cb3-81"></a>		<span class="kw">label</span> <span class="kw">var</span> descrip_2		<span class="st">"50 digit description"</span>
</span>
<span id="cb3-82"><a href="#cb3-82"></a>		<span class="kw">label</span> <span class="kw">var</span> quantity_1	<span class="st">"3-digit unit of q 1"</span>
</span>
<span id="cb3-83"><a href="#cb3-83"></a>		<span class="kw">label</span> <span class="kw">var</span> quantity_2	<span class="st">"3-digit unit of q 1"</span>
</span>
<span id="cb3-84"><a href="#cb3-84"></a>
</span>
<span id="cb3-85"><a href="#cb3-85"></a>		cd <span class="st">"$XC"</span>
</span>
<span id="cb3-86"><a href="#cb3-86"></a>		<span class="kw">save</span> concord_1<span class="ot">`y'</span>, replace
</span>
<span id="cb3-87"><a href="#cb3-87"></a>	}
</span>
<span id="cb3-88"><a href="#cb3-88"></a>}
</span>
<span id="cb3-89"><a href="#cb3-89"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">in</span> <span class="st">"16"</span> <span class="st">"17"</span> {
</span>
<span id="cb3-90"><a href="#cb3-90"></a>	<span class="kw">foreach</span> <span class="fu">m</span> <span class="kw">in</span> <span class="st">"12"</span> <span class="co">/*"01" "02" "03" "04" "05" "06" "07" "08" "09" "10" "11" "12"*/</span> {
</span>
<span id="cb3-91"><a href="#cb3-91"></a>	
</span>
<span id="cb3-92"><a href="#cb3-92"></a>		cd <span class="kw">d</span>:\<span class="kw">data</span>\raw_yale_trade\monthly
</span>
<span id="cb3-93"><a href="#cb3-93"></a>		unzipfile IMDB<span class="ot">`y'`m'</span>, replace
</span>
<span id="cb3-94"><a href="#cb3-94"></a>
</span>
<span id="cb3-95"><a href="#cb3-95"></a>		infix <span class="co">///
</span></span>
<span id="cb3-96"><a href="#cb3-96"></a>			<span class="kw">double</span> commodity 	1-10 <span class="co">///
</span></span>
<span id="cb3-97"><a href="#cb3-97"></a>			str descrip_1 		11-160 <span class="co">///
</span></span>
<span id="cb3-98"><a href="#cb3-98"></a>			str descrip_2 		161-210 <span class="co">///
</span></span>
<span id="cb3-99"><a href="#cb3-99"></a>			str quantity_1 		211-213 <span class="co">///
</span></span>
<span id="cb3-100"><a href="#cb3-100"></a>			str quantity_2 		214-216 <span class="co">///
</span></span>
<span id="cb3-101"><a href="#cb3-101"></a>			<span class="kw">double</span> sitc 		217-221 <span class="co">///
</span></span>
<span id="cb3-102"><a href="#cb3-102"></a>			<span class="kw">double</span> end_use 		222-226 <span class="co">///
</span></span>
<span id="cb3-103"><a href="#cb3-103"></a>			str naics			227-232 <span class="co">///
</span></span>
<span id="cb3-104"><a href="#cb3-104"></a>			usda				233-233 <span class="co">///
</span></span>
<span id="cb3-105"><a href="#cb3-105"></a>			hitech				234-235 <span class="co">///
</span></span>
<span id="cb3-106"><a href="#cb3-106"></a>		<span class="kw">using</span> CONCORD.TXT, clear
</span>
<span id="cb3-107"><a href="#cb3-107"></a>		
</span>
<span id="cb3-108"><a href="#cb3-108"></a>		<span class="kw">label</span> <span class="kw">var</span> commodity 	<span class="st">"10-Digit Harmonized Tariff Schedule (HTS) Code"</span>
</span>
<span id="cb3-109"><a href="#cb3-109"></a>		<span class="kw">label</span> <span class="kw">var</span> descrip_1		<span class="st">"150 digit description"</span>
</span>
<span id="cb3-110"><a href="#cb3-110"></a>		<span class="kw">label</span> <span class="kw">var</span> descrip_2		<span class="st">"50 digit description"</span>
</span>
<span id="cb3-111"><a href="#cb3-111"></a>		<span class="kw">label</span> <span class="kw">var</span> quantity_1	<span class="st">"3-digit unit of q 1"</span>
</span>
<span id="cb3-112"><a href="#cb3-112"></a>		<span class="kw">label</span> <span class="kw">var</span> quantity_2	<span class="st">"3-digit unit of q 1"</span>
</span>
<span id="cb3-113"><a href="#cb3-113"></a>
</span>
<span id="cb3-114"><a href="#cb3-114"></a>		cd <span class="st">"$MC"</span>
</span>
<span id="cb3-115"><a href="#cb3-115"></a>		<span class="kw">save</span> concord_20<span class="ot">`y'</span>, replace
</span>
<span id="cb3-116"><a href="#cb3-116"></a>	}
</span>
<span id="cb3-117"><a href="#cb3-117"></a>}
</span>
<span id="cb3-118"><a href="#cb3-118"></a>*/
</span>
<span id="cb3-119"><a href="#cb3-119"></a>
</span>
<span id="cb3-120"><a href="#cb3-120"></a>
</span>
<span id="cb3-121"><a href="#cb3-121"></a>
</span>
<span id="cb3-122"><a href="#cb3-122"></a>
</span>
<span id="cb3-123"><a href="#cb3-123"></a>
</span>
<span id="cb3-124"><a href="#cb3-124"></a>
</span>
<span id="cb3-125"><a href="#cb3-125"></a>
</span>
<span id="cb3-126"><a href="#cb3-126"></a>**1 Assemble the concordance files from the Census trade
</span>
<span id="cb3-127"><a href="#cb3-127"></a>*files <span class="kw">for</span> the years 1989-2017
</span>
<span id="cb3-128"><a href="#cb3-128"></a>
</span>
<span id="cb3-129"><a href="#cb3-129"></a>*1.1 Imports
</span>
<span id="cb3-130"><a href="#cb3-130"></a>cd <span class="st">"$MC"</span>
</span>
<span id="cb3-131"><a href="#cb3-131"></a><span class="kw">use</span> concord_1989, clear
</span>
<span id="cb3-132"><a href="#cb3-132"></a><span class="kw">gen</span> <span class="fu">year</span>=1989
</span>
<span id="cb3-133"><a href="#cb3-133"></a><span class="kw">forvalues</span> <span class="fu">y</span>=1990/2017 {
</span>
<span id="cb3-134"><a href="#cb3-134"></a>	<span class="kw">display</span>[<span class="st">"`y'"</span>]
</span>
<span id="cb3-135"><a href="#cb3-135"></a>
</span>
<span id="cb3-136"><a href="#cb3-136"></a>	<span class="kw">append</span> <span class="kw">using</span> concord_<span class="ot">`y'</span>
</span>
<span id="cb3-137"><a href="#cb3-137"></a>	
</span>
<span id="cb3-138"><a href="#cb3-138"></a>	<span class="kw">replace</span> <span class="fu">year</span>=<span class="ot">`y'</span> <span class="kw">if</span> <span class="fu">year</span>==.
</span>
<span id="cb3-139"><a href="#cb3-139"></a>	
</span>
<span id="cb3-140"><a href="#cb3-140"></a>	<span class="kw">if</span> <span class="ot">`y'</span> &lt;2000 {
</span>
<span id="cb3-141"><a href="#cb3-141"></a>		<span class="kw">keep</span> commodity <span class="fu">year</span> sic 
</span>
<span id="cb3-142"><a href="#cb3-142"></a>	}
</span>
<span id="cb3-143"><a href="#cb3-143"></a>	<span class="kw">if</span> <span class="ot">`y'</span> &gt;=2000 {
</span>
<span id="cb3-144"><a href="#cb3-144"></a>		<span class="kw">keep</span> commodity <span class="fu">year</span> naics sic
</span>
<span id="cb3-145"><a href="#cb3-145"></a>	}
</span>
<span id="cb3-146"><a href="#cb3-146"></a>	<span class="kw">if</span> <span class="ot">`y'</span>==2005 {
</span>
<span id="cb3-147"><a href="#cb3-147"></a>		<span class="kw">rename</span> commodity scommodity
</span>
<span id="cb3-148"><a href="#cb3-148"></a>		<span class="kw">destring</span> scommodity, <span class="kw">force</span> g(commodity)
</span>
<span id="cb3-149"><a href="#cb3-149"></a>	}
</span>
<span id="cb3-150"><a href="#cb3-150"></a>}
</span>
<span id="cb3-151"><a href="#cb3-151"></a>cd <span class="st">"$CI"</span>
</span>
<span id="cb3-152"><a href="#cb3-152"></a><span class="kw">duplicates</span> drop
</span>
<span id="cb3-153"><a href="#cb3-153"></a><span class="kw">save</span> concord_m_1989_2017_abbreviated, replace
</span>
<span id="cb3-154"><a href="#cb3-154"></a>
</span>
<span id="cb3-155"><a href="#cb3-155"></a>*Check number <span class="kw">of</span> manufacturing codes
</span>
<span id="cb3-156"><a href="#cb3-156"></a><span class="kw">use</span> concord_m_1989_2017_abbreviated, clear
</span>
<span id="cb3-157"><a href="#cb3-157"></a><span class="kw">gen</span> man =<span class="fu">substr</span>(naics,1,1)==<span class="st">"3"</span>
</span>
<span id="cb3-158"><a href="#cb3-158"></a><span class="kw">egen</span> x = <span class="fu">tag</span>(naics <span class="fu">year</span>)
</span>
<span id="cb3-159"><a href="#cb3-159"></a><span class="kw">table</span> <span class="fu">year</span> <span class="kw">if</span> x, c(<span class="kw">sum</span> man)
</span>
<span id="cb3-160"><a href="#cb3-160"></a>
</span>
<span id="cb3-161"><a href="#cb3-161"></a>*1.2 Exports
</span>
<span id="cb3-162"><a href="#cb3-162"></a>cd <span class="st">"$XC"</span>
</span>
<span id="cb3-163"><a href="#cb3-163"></a><span class="kw">use</span> concord_89, clear
</span>
<span id="cb3-164"><a href="#cb3-164"></a><span class="kw">gen</span> <span class="fu">year</span>=89
</span>
<span id="cb3-165"><a href="#cb3-165"></a><span class="kw">forvalues</span> <span class="fu">y</span>=90/117 {
</span>
<span id="cb3-166"><a href="#cb3-166"></a>	<span class="kw">display</span>[<span class="st">"`y'"</span>]
</span>
<span id="cb3-167"><a href="#cb3-167"></a>	<span class="kw">append</span> <span class="kw">using</span> concord_<span class="ot">`y'</span>
</span>
<span id="cb3-168"><a href="#cb3-168"></a>	<span class="kw">replace</span> <span class="fu">year</span>=<span class="ot">`y'</span> <span class="kw">if</span> <span class="fu">year</span>==.
</span>
<span id="cb3-169"><a href="#cb3-169"></a>	*Note that NAICS codes are <span class="kw">not</span> reported <span class="kw">until</span> 2000
</span>
<span id="cb3-170"><a href="#cb3-170"></a>	<span class="kw">if</span> <span class="ot">`y'</span> &lt;100 {
</span>
<span id="cb3-171"><a href="#cb3-171"></a>		<span class="kw">keep</span> commodity <span class="fu">year</span> sic
</span>
<span id="cb3-172"><a href="#cb3-172"></a>	}
</span>
<span id="cb3-173"><a href="#cb3-173"></a>	<span class="kw">if</span> <span class="ot">`y'</span> &gt;=100 &amp; <span class="ot">`y'</span>&lt;=106 {
</span>
<span id="cb3-174"><a href="#cb3-174"></a>		<span class="kw">keep</span> commodity <span class="fu">year</span> naics sic
</span>
<span id="cb3-175"><a href="#cb3-175"></a>	}
</span>
<span id="cb3-176"><a href="#cb3-176"></a>	<span class="kw">if</span> <span class="ot">`y'</span>==106 {
</span>
<span id="cb3-177"><a href="#cb3-177"></a>		<span class="kw">rename</span> commodity scommodity
</span>
<span id="cb3-178"><a href="#cb3-178"></a>		<span class="kw">destring</span> scommodity, <span class="kw">force</span> g(commodity)
</span>
<span id="cb3-179"><a href="#cb3-179"></a>		<span class="kw">rename</span> sic ssic
</span>
<span id="cb3-180"><a href="#cb3-180"></a>	}	
</span>
<span id="cb3-181"><a href="#cb3-181"></a>	<span class="kw">if</span> <span class="ot">`y'</span> &gt;106 {
</span>
<span id="cb3-182"><a href="#cb3-182"></a>		<span class="kw">keep</span> commodity <span class="fu">year</span> naics sic ssic
</span>
<span id="cb3-183"><a href="#cb3-183"></a>	}
</span>
<span id="cb3-184"><a href="#cb3-184"></a>}
</span>
<span id="cb3-185"><a href="#cb3-185"></a><span class="kw">drop</span> sic
</span>
<span id="cb3-186"><a href="#cb3-186"></a><span class="kw">rename</span> ssic sic
</span>
<span id="cb3-187"><a href="#cb3-187"></a><span class="kw">replace</span> <span class="fu">year</span>=<span class="fu">year</span>+1900
</span>
<span id="cb3-188"><a href="#cb3-188"></a>cd <span class="st">"$CI"</span>
</span>
<span id="cb3-189"><a href="#cb3-189"></a><span class="kw">duplicates</span> drop
</span>
<span id="cb3-190"><a href="#cb3-190"></a><span class="kw">save</span> concord_x_1989_2017_abbreviated, replace
</span>
<span id="cb3-191"><a href="#cb3-191"></a>
</span>
<span id="cb3-192"><a href="#cb3-192"></a>*check # man codes
</span>
<span id="cb3-193"><a href="#cb3-193"></a>*
</span>
<span id="cb3-194"><a href="#cb3-194"></a>*	Dip <span class="kw">in</span> 2013 due to implementation <span class="kw">of</span> NAICS 2012
</span>
<span id="cb3-195"><a href="#cb3-195"></a>*
</span>
<span id="cb3-196"><a href="#cb3-196"></a>*	But why recovery (somewhat) starting <span class="kw">in</span> 2014
</span>
<span id="cb3-197"><a href="#cb3-197"></a>*
</span>
<span id="cb3-198"><a href="#cb3-198"></a><span class="kw">use</span> concord_x_1989_2017_abbreviated, clear
</span>
<span id="cb3-199"><a href="#cb3-199"></a><span class="kw">gen</span> man =<span class="fu">substr</span>(naics,1,1)==<span class="st">"3"</span>
</span>
<span id="cb3-200"><a href="#cb3-200"></a><span class="kw">egen</span> x = <span class="fu">tag</span>(naics <span class="fu">year</span>)
</span>
<span id="cb3-201"><a href="#cb3-201"></a><span class="kw">table</span> <span class="fu">year</span> <span class="kw">if</span> x, c(<span class="kw">sum</span> man)
</span>
<span id="cb3-202"><a href="#cb3-202"></a>
</span>
<span id="cb3-203"><a href="#cb3-203"></a>
</span>
<span id="cb3-204"><a href="#cb3-204"></a>
</span>
<span id="cb3-205"><a href="#cb3-205"></a>
</span>
<span id="cb3-206"><a href="#cb3-206"></a>**2 SIC Mapping 
</span>
<span id="cb3-207"><a href="#cb3-207"></a>*Assigns SIC codes to HS codes <span class="kw">for</span> years after <span class="kw">end</span> <span class="kw">of</span> SIC
</span>
<span id="cb3-208"><a href="#cb3-208"></a>
</span>
<span id="cb3-209"><a href="#cb3-209"></a>cd <span class="st">"$CI"</span>
</span>
<span id="cb3-210"><a href="#cb3-210"></a><span class="kw">foreach</span> zzz <span class="kw">in</span> x <span class="fu">m</span> {
</span>
<span id="cb3-211"><a href="#cb3-211"></a>
</span>
<span id="cb3-212"><a href="#cb3-212"></a>	*Create <span class="ot">list</span> <span class="kw">of</span> HS-SIC mappings <span class="kw">for</span> 2001
</span>
<span id="cb3-213"><a href="#cb3-213"></a>	*(<span class="fu">last</span> <span class="fu">year</span> <span class="kw">for</span> which sic <span class="kw">data</span> are available)
</span>
<span id="cb3-214"><a href="#cb3-214"></a>	<span class="kw">use</span> concord_<span class="ot">`zzz'</span>_1989_2017_abbreviated, clear
</span>
<span id="cb3-215"><a href="#cb3-215"></a>	<span class="kw">replace</span> <span class="fu">year</span>=<span class="fu">year</span>-1900
</span>
<span id="cb3-216"><a href="#cb3-216"></a>	<span class="kw">keep</span> <span class="kw">if</span> <span class="fu">year</span>==101
</span>
<span id="cb3-217"><a href="#cb3-217"></a>	<span class="kw">keep</span> commodity sic
</span>
<span id="cb3-218"><a href="#cb3-218"></a>	<span class="kw">drop</span> <span class="kw">if</span> sic==<span class="st">""</span>
</span>
<span id="cb3-219"><a href="#cb3-219"></a>	<span class="kw">duplicates</span> <span class="kw">drop</span> commodity, <span class="kw">force</span> 
</span>
<span id="cb3-220"><a href="#cb3-220"></a>	<span class="kw">sort</span> commodity
</span>
<span id="cb3-221"><a href="#cb3-221"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp0, replace
</span>
<span id="cb3-222"><a href="#cb3-222"></a>	
</span>
<span id="cb3-223"><a href="#cb3-223"></a>	*Match <span class="ot">list</span> <span class="kw">of</span> 2001 HS-SIC mappings to <span class="kw">post</span>-2001 years
</span>
<span id="cb3-224"><a href="#cb3-224"></a>	<span class="kw">use</span> concord_<span class="ot">`zzz'</span>_1989_2017_abbreviated, clear
</span>
<span id="cb3-225"><a href="#cb3-225"></a>	<span class="kw">replace</span> <span class="fu">year</span>=<span class="fu">year</span>-1900
</span>
<span id="cb3-226"><a href="#cb3-226"></a>	<span class="kw">keep</span> <span class="kw">if</span> <span class="fu">year</span>&gt;101
</span>
<span id="cb3-227"><a href="#cb3-227"></a>	<span class="kw">keep</span> commodity
</span>
<span id="cb3-228"><a href="#cb3-228"></a>	<span class="kw">duplicates</span> <span class="kw">drop</span> commodity, force
</span>
<span id="cb3-229"><a href="#cb3-229"></a>	<span class="kw">sort</span> commodity
</span>
<span id="cb3-230"><a href="#cb3-230"></a>	<span class="kw">merge</span> commodity <span class="kw">using</span> <span class="ot">`zzz'</span>temp0, <span class="kw">keep</span>(sic) 
</span>
<span id="cb3-231"><a href="#cb3-231"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-232"><a href="#cb3-232"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-233"><a href="#cb3-233"></a>	<span class="kw">gen</span> <span class="kw">double</span> hs=commodity
</span>
<span id="cb3-234"><a href="#cb3-234"></a>	<span class="kw">format</span> hs %15.0fc
</span>
<span id="cb3-235"><a href="#cb3-235"></a>	<span class="kw">egen</span> sic87=<span class="fu">group</span>(sic)
</span>
<span id="cb3-236"><a href="#cb3-236"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp_01, replace
</span>
<span id="cb3-237"><a href="#cb3-237"></a>
</span>
<span id="cb3-238"><a href="#cb3-238"></a>	*Save <span class="kw">two</span> versions <span class="kw">of</span> <span class="fu">group</span>-naics mapping <span class="kw">for</span> below.
</span>
<span id="cb3-239"><a href="#cb3-239"></a>	*These are simply used <span class="kw">for</span> labeling the source of
</span>
<span id="cb3-240"><a href="#cb3-240"></a>	*HS-SIC matches.
</span>
<span id="cb3-241"><a href="#cb3-241"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_01, clear
</span>
<span id="cb3-242"><a href="#cb3-242"></a>	<span class="kw">collapse</span> (<span class="kw">mean</span>) sic87, <span class="kw">by</span>(sic)
</span>
<span id="cb3-243"><a href="#cb3-243"></a>	<span class="kw">rename</span> sic87 sic87_new1
</span>
<span id="cb3-244"><a href="#cb3-244"></a>	<span class="kw">rename</span> sic sic_new1
</span>
<span id="cb3-245"><a href="#cb3-245"></a>	<span class="kw">drop</span> <span class="kw">if</span> sic_new1==<span class="st">""</span> | sic87_new1==.
</span>
<span id="cb3-246"><a href="#cb3-246"></a>	<span class="kw">sort</span> sic87_new1
</span>
<span id="cb3-247"><a href="#cb3-247"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp1, replace
</span>
<span id="cb3-248"><a href="#cb3-248"></a>	
</span>
<span id="cb3-249"><a href="#cb3-249"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_01, clear
</span>
<span id="cb3-250"><a href="#cb3-250"></a>	<span class="kw">collapse</span> (<span class="kw">mean</span>) sic87, <span class="kw">by</span>(sic)
</span>
<span id="cb3-251"><a href="#cb3-251"></a>	<span class="kw">rename</span> sic87 sic87_new2
</span>
<span id="cb3-252"><a href="#cb3-252"></a>	<span class="kw">rename</span> sic sic_new2
</span>
<span id="cb3-253"><a href="#cb3-253"></a>	<span class="kw">drop</span> <span class="kw">if</span> sic_new2==<span class="st">""</span> | sic87_new2==.
</span>
<span id="cb3-254"><a href="#cb3-254"></a>	<span class="kw">sort</span> sic87_new2
</span>
<span id="cb3-255"><a href="#cb3-255"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp2, replace
</span>
<span id="cb3-256"><a href="#cb3-256"></a>
</span>
<span id="cb3-257"><a href="#cb3-257"></a>	*First Mechanical Match
</span>
<span id="cb3-258"><a href="#cb3-258"></a>	*Look <span class="fu">at</span> SIC matches <span class="kw">for</span> HS10s within an HS9.  If <span class="ot">all</span> non-missing
</span>
<span id="cb3-259"><a href="#cb3-259"></a>	*SIC codes are the same, assign that SIC code to unmatched HS10s within
</span>
<span id="cb3-260"><a href="#cb3-260"></a>	*that HS9.  Repeat <span class="kw">for</span> higher <span class="kw">levels</span> <span class="kw">of</span> aggregation.
</span>
<span id="cb3-261"><a href="#cb3-261"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_01, clear
</span>
<span id="cb3-262"><a href="#cb3-262"></a>	<span class="kw">gen</span> sic87_new1 = sic87
</span>
<span id="cb3-263"><a href="#cb3-263"></a>	<span class="kw">sum</span> hs sic87*
</span>
<span id="cb3-264"><a href="#cb3-264"></a>	<span class="kw">quietly</span> {
</span>
<span id="cb3-265"><a href="#cb3-265"></a>	  <span class="kw">foreach</span> x <span class="kw">in</span> 9 8 7 6 5 4 3 2 {
</span>
<span id="cb3-266"><a href="#cb3-266"></a>		<span class="kw">noisily</span> <span class="kw">display</span> [<span class="ot">`x'</span>]
</span>
<span id="cb3-267"><a href="#cb3-267"></a>		<span class="kw">local</span> <span class="fu">y</span>       = 10-<span class="ot">`x'</span>
</span>
<span id="cb3-268"><a href="#cb3-268"></a>		<span class="kw">gen</span> hs<span class="ot">`x'</span>     = <span class="kw">int</span>(hs/(10^<span class="ot">`y'</span>))
</span>
<span id="cb3-269"><a href="#cb3-269"></a>		<span class="kw">egen</span> t1       = <span class="kw">mean</span>(sic87), <span class="kw">by</span>(hs<span class="ot">`x'</span>)
</span>
<span id="cb3-270"><a href="#cb3-270"></a>		<span class="kw">egen</span> t2       = <span class="fu">sd</span>(sic87), <span class="kw">by</span>(hs<span class="ot">`x'</span>)
</span>
<span id="cb3-271"><a href="#cb3-271"></a>		<span class="kw">egen</span> t3       = <span class="fu">count</span>(sic87), <span class="kw">by</span>(hs<span class="ot">`x'</span>)
</span>
<span id="cb3-272"><a href="#cb3-272"></a>		<span class="kw">gen</span> sic87_<span class="ot">`x'</span> = t1 <span class="kw">if</span> t2==0 | t3==1
</span>
<span id="cb3-273"><a href="#cb3-273"></a>		<span class="kw">replace</span> sic87_new1 = sic87_<span class="ot">`x'</span> <span class="kw">if</span> sic87==. &amp; sic87_new1==.
</span>
<span id="cb3-274"><a href="#cb3-274"></a>		<span class="kw">drop</span> t1 t2 t3
</span>
<span id="cb3-275"><a href="#cb3-275"></a>		<span class="kw">drop</span> hs<span class="ot">`x'</span> sic87_<span class="ot">`x'</span>
</span>
<span id="cb3-276"><a href="#cb3-276"></a>	  } 
</span>
<span id="cb3-277"><a href="#cb3-277"></a>	}
</span>
<span id="cb3-278"><a href="#cb3-278"></a>	<span class="kw">sum</span> hs sic87 sic87_new1
</span>
<span id="cb3-279"><a href="#cb3-279"></a>	<span class="kw">sort</span> hs
</span>
<span id="cb3-280"><a href="#cb3-280"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp_02, replace
</span>
<span id="cb3-281"><a href="#cb3-281"></a>	
</span>
<span id="cb3-282"><a href="#cb3-282"></a>	*Second Mechanical Match
</span>
<span id="cb3-283"><a href="#cb3-283"></a>	*Sort HS codes.  For unmatched HS codes (<span class="kw">or</span> contiguous groups <span class="kw">of</span> HS10
</span>
<span id="cb3-284"><a href="#cb3-284"></a>	*codes), look <span class="fu">at</span> the matched HS10 codes that precede and follow.  If
</span>
<span id="cb3-285"><a href="#cb3-285"></a>	*matches <span class="kw">for</span> preceding and following HS10 codes are identical, assign
</span>
<span id="cb3-286"><a href="#cb3-286"></a>	*that SIC code to the unmatched HS code(<span class="fu">s</span>).
</span>
<span id="cb3-287"><a href="#cb3-287"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_02, clear
</span>
<span id="cb3-288"><a href="#cb3-288"></a>	<span class="kw">gen</span> sic87_new2 = sic87_new1
</span>
<span id="cb3-289"><a href="#cb3-289"></a>	<span class="kw">gen</span> <span class="kw">begin</span>      = 1 <span class="kw">if</span> sic87_new1==. &amp; sic87_new1[<span class="dt">_n</span>-1]~=.
</span>
<span id="cb3-290"><a href="#cb3-290"></a>	<span class="kw">gen</span> <span class="kw">end</span>        = sic87_new1==. &amp; sic87_new1[<span class="dt">_n</span>+1]~=.
</span>
<span id="cb3-291"><a href="#cb3-291"></a>	<span class="kw">gen</span> bsum       = <span class="kw">sum</span>(<span class="kw">begin</span>)
</span>
<span id="cb3-292"><a href="#cb3-292"></a>	<span class="kw">gen</span> gap        = sic87_new1==.
</span>
<span id="cb3-293"><a href="#cb3-293"></a>	<span class="kw">replace</span> bsum=. <span class="kw">if</span> gap==0
</span>
<span id="cb3-294"><a href="#cb3-294"></a>	<span class="kw">gen</span> sb         = sic87_new1[<span class="dt">_n</span>-1]*begin
</span>
<span id="cb3-295"><a href="#cb3-295"></a>	<span class="kw">gen</span> se         = sic87_new1[<span class="dt">_n</span>+1]*end
</span>
<span id="cb3-296"><a href="#cb3-296"></a>	<span class="kw">egen</span> tb        = <span class="kw">mean</span>(sb), <span class="kw">by</span>(bsum)
</span>
<span id="cb3-297"><a href="#cb3-297"></a>	<span class="kw">egen</span> <span class="kw">te</span>        = <span class="kw">mean</span>(se), <span class="kw">by</span>(bsum)
</span>
<span id="cb3-298"><a href="#cb3-298"></a>	<span class="kw">gen</span> <span class="fu">match</span>      = tb==te
</span>
<span id="cb3-299"><a href="#cb3-299"></a>	<span class="kw">replace</span> sic87_new2 = tb <span class="kw">if</span> <span class="fu">match</span>==1 &amp; sic87_new1==.
</span>
<span id="cb3-300"><a href="#cb3-300"></a>	<span class="kw">sum</span> hs sic87*
</span>
<span id="cb3-301"><a href="#cb3-301"></a>	<span class="kw">drop</span> <span class="kw">begin</span> <span class="kw">end</span> bsum gap sb se tb <span class="kw">te</span> match
</span>
<span id="cb3-302"><a href="#cb3-302"></a>	<span class="kw">sort</span> hs
</span>
<span id="cb3-303"><a href="#cb3-303"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp_03, replace
</span>
<span id="cb3-304"><a href="#cb3-304"></a>	
</span>
<span id="cb3-305"><a href="#cb3-305"></a>	*Merge <span class="kw">in</span> <span class="st">"group"</span> codes created above, which are only used <span class="kw">for</span> labeling.
</span>
<span id="cb3-306"><a href="#cb3-306"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_03, clear
</span>
<span id="cb3-307"><a href="#cb3-307"></a>	<span class="kw">sort</span> sic87_new1
</span>
<span id="cb3-308"><a href="#cb3-308"></a>	<span class="kw">merge</span> sic87_new1 <span class="kw">using</span> <span class="ot">`zzz'</span>temp1, <span class="kw">keep</span>(sic_new1)
</span>
<span id="cb3-309"><a href="#cb3-309"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-310"><a href="#cb3-310"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-311"><a href="#cb3-311"></a>	<span class="kw">sort</span> sic87_new2
</span>
<span id="cb3-312"><a href="#cb3-312"></a>	<span class="kw">merge</span> sic87_new2 <span class="kw">using</span> <span class="ot">`zzz'</span>temp2, <span class="kw">keep</span>(sic_new2)
</span>
<span id="cb3-313"><a href="#cb3-313"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-314"><a href="#cb3-314"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-315"><a href="#cb3-315"></a>	<span class="kw">sort</span> hs
</span>
<span id="cb3-316"><a href="#cb3-316"></a>	<span class="kw">gen</span> t=sic87_new1~=.
</span>
<span id="cb3-317"><a href="#cb3-317"></a>	<span class="kw">tab</span> t
</span>
<span id="cb3-318"><a href="#cb3-318"></a>	<span class="kw">drop</span> t 
</span>
<span id="cb3-319"><a href="#cb3-319"></a>      <span class="kw">drop</span> sic87*
</span>
<span id="cb3-320"><a href="#cb3-320"></a>	<span class="kw">format</span> hs %15.0g
</span>
<span id="cb3-321"><a href="#cb3-321"></a>	<span class="kw">drop</span> <span class="kw">if</span> hs&lt;100
</span>
<span id="cb3-322"><a href="#cb3-322"></a>	<span class="kw">format</span> commodity %15.0fc
</span>
<span id="cb3-323"><a href="#cb3-323"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>_concord_89_117_sicfillin, replace
</span>
<span id="cb3-324"><a href="#cb3-324"></a>}
</span>
<span id="cb3-325"><a href="#cb3-325"></a>
</span>
<span id="cb3-326"><a href="#cb3-326"></a>
</span>
<span id="cb3-327"><a href="#cb3-327"></a>
</span>
<span id="cb3-328"><a href="#cb3-328"></a>**2 NAICS
</span>
<span id="cb3-329"><a href="#cb3-329"></a>*Assigns NAICS codes to HS codes <span class="kw">for</span> years before <span class="bn">start</span> <span class="kw">of</span> NAICS
</span>
<span id="cb3-330"><a href="#cb3-330"></a>
</span>
<span id="cb3-331"><a href="#cb3-331"></a>cd <span class="st">"$CI"</span>
</span>
<span id="cb3-332"><a href="#cb3-332"></a><span class="kw">foreach</span> zzz <span class="kw">in</span> x <span class="fu">m</span> {
</span>
<span id="cb3-333"><a href="#cb3-333"></a>
</span>
<span id="cb3-334"><a href="#cb3-334"></a>	*Create <span class="ot">list</span> <span class="kw">of</span> HS-NAICS mappings <span class="kw">for</span> 2000
</span>
<span id="cb3-335"><a href="#cb3-335"></a>	*(first <span class="fu">year</span> <span class="kw">for</span> which naics <span class="kw">data</span> are available)
</span>
<span id="cb3-336"><a href="#cb3-336"></a>	<span class="kw">use</span> concord_<span class="ot">`zzz'</span>_1989_2017_abbreviated, clear
</span>
<span id="cb3-337"><a href="#cb3-337"></a>	<span class="kw">replace</span> <span class="fu">year</span>=<span class="fu">year</span>-1900
</span>
<span id="cb3-338"><a href="#cb3-338"></a>	<span class="kw">keep</span> <span class="kw">if</span> <span class="fu">year</span>==100
</span>
<span id="cb3-339"><a href="#cb3-339"></a>	<span class="kw">keep</span> commodity naics
</span>
<span id="cb3-340"><a href="#cb3-340"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics==<span class="st">""</span>
</span>
<span id="cb3-341"><a href="#cb3-341"></a>	<span class="kw">duplicates</span> <span class="kw">drop</span> commodity, <span class="kw">force</span> 
</span>
<span id="cb3-342"><a href="#cb3-342"></a>	<span class="kw">sort</span> commodity
</span>
<span id="cb3-343"><a href="#cb3-343"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp0, replace
</span>
<span id="cb3-344"><a href="#cb3-344"></a>	
</span>
<span id="cb3-345"><a href="#cb3-345"></a>	*Match <span class="ot">list</span> <span class="kw">of</span> 2000 HS-NAICS mappings to pre-2000 years
</span>
<span id="cb3-346"><a href="#cb3-346"></a>	<span class="kw">use</span> concord_<span class="ot">`zzz'</span>_1989_2017_abbreviated, clear
</span>
<span id="cb3-347"><a href="#cb3-347"></a>	<span class="kw">replace</span> <span class="fu">year</span>=<span class="fu">year</span>-1900
</span>
<span id="cb3-348"><a href="#cb3-348"></a>	<span class="kw">keep</span> <span class="kw">if</span> <span class="fu">year</span>&lt;100
</span>
<span id="cb3-349"><a href="#cb3-349"></a>	<span class="kw">keep</span> commodity
</span>
<span id="cb3-350"><a href="#cb3-350"></a>	<span class="kw">duplicates</span> <span class="kw">drop</span> commodity, force
</span>
<span id="cb3-351"><a href="#cb3-351"></a>	<span class="kw">sort</span> commodity
</span>
<span id="cb3-352"><a href="#cb3-352"></a>	<span class="kw">merge</span> commodity <span class="kw">using</span> <span class="ot">`zzz'</span>temp0, <span class="kw">keep</span>(naics) 
</span>
<span id="cb3-353"><a href="#cb3-353"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-354"><a href="#cb3-354"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-355"><a href="#cb3-355"></a>	<span class="kw">gen</span> <span class="kw">double</span> hs=commodity
</span>
<span id="cb3-356"><a href="#cb3-356"></a>	<span class="kw">egen</span> naics87=<span class="fu">group</span>(naics)
</span>
<span id="cb3-357"><a href="#cb3-357"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp_01, replace
</span>
<span id="cb3-358"><a href="#cb3-358"></a>
</span>
<span id="cb3-359"><a href="#cb3-359"></a>	*Save <span class="kw">two</span> versions <span class="kw">of</span> <span class="fu">group</span>-naics mapping <span class="kw">for</span> below.
</span>
<span id="cb3-360"><a href="#cb3-360"></a>	*These are simply used <span class="kw">for</span> labeling the source of
</span>
<span id="cb3-361"><a href="#cb3-361"></a>	*HS-NAICS matches.
</span>
<span id="cb3-362"><a href="#cb3-362"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_01, clear
</span>
<span id="cb3-363"><a href="#cb3-363"></a>	<span class="kw">collapse</span> (<span class="kw">mean</span>) naics87, <span class="kw">by</span>(naics)
</span>
<span id="cb3-364"><a href="#cb3-364"></a>	<span class="kw">rename</span> naics87 naics87_new1
</span>
<span id="cb3-365"><a href="#cb3-365"></a>	<span class="kw">rename</span> naics naics_new1
</span>
<span id="cb3-366"><a href="#cb3-366"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics_new1==<span class="st">""</span> | naics87_new1==.
</span>
<span id="cb3-367"><a href="#cb3-367"></a>	<span class="kw">sort</span> naics87_new1
</span>
<span id="cb3-368"><a href="#cb3-368"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp1, replace
</span>
<span id="cb3-369"><a href="#cb3-369"></a>	
</span>
<span id="cb3-370"><a href="#cb3-370"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_01, clear
</span>
<span id="cb3-371"><a href="#cb3-371"></a>	<span class="kw">collapse</span> (<span class="kw">mean</span>) naics87, <span class="kw">by</span>(naics)
</span>
<span id="cb3-372"><a href="#cb3-372"></a>	<span class="kw">rename</span> naics87 naics87_new2
</span>
<span id="cb3-373"><a href="#cb3-373"></a>	<span class="kw">rename</span> naics naics_new2
</span>
<span id="cb3-374"><a href="#cb3-374"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics_new2==<span class="st">""</span> | naics87_new2==.
</span>
<span id="cb3-375"><a href="#cb3-375"></a>	<span class="kw">sort</span> naics87_new2
</span>
<span id="cb3-376"><a href="#cb3-376"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp2, replace
</span>
<span id="cb3-377"><a href="#cb3-377"></a>
</span>
<span id="cb3-378"><a href="#cb3-378"></a>
</span>
<span id="cb3-379"><a href="#cb3-379"></a>	*First Mechanical Match
</span>
<span id="cb3-380"><a href="#cb3-380"></a>	*Look <span class="fu">at</span> NAICS matches <span class="kw">for</span> HS10s within an HS9.  If <span class="ot">all</span> non-missing
</span>
<span id="cb3-381"><a href="#cb3-381"></a>	*NAICS codes are the same, assign that NAICS code to unmatched HS10s within
</span>
<span id="cb3-382"><a href="#cb3-382"></a>	*that HS9.  Repeat <span class="kw">for</span> higher <span class="kw">levels</span> <span class="kw">of</span> aggregation. 
</span>
<span id="cb3-383"><a href="#cb3-383"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_01, clear
</span>
<span id="cb3-384"><a href="#cb3-384"></a>	<span class="kw">gen</span> naics87_new1 = naics87
</span>
<span id="cb3-385"><a href="#cb3-385"></a>	<span class="kw">sum</span> hs naics87*
</span>
<span id="cb3-386"><a href="#cb3-386"></a>	<span class="kw">quietly</span> {
</span>
<span id="cb3-387"><a href="#cb3-387"></a>	  <span class="kw">foreach</span> x <span class="kw">in</span> 9 8 7 6 5 4 3 2 {
</span>
<span id="cb3-388"><a href="#cb3-388"></a>		<span class="kw">noisily</span> <span class="kw">display</span> [<span class="ot">`x'</span>]
</span>
<span id="cb3-389"><a href="#cb3-389"></a>		<span class="kw">local</span> <span class="fu">y</span>       = 10-<span class="ot">`x'</span>
</span>
<span id="cb3-390"><a href="#cb3-390"></a>		<span class="kw">gen</span> hs<span class="ot">`x'</span>     = <span class="kw">int</span>(hs/(10^<span class="ot">`y'</span>))
</span>
<span id="cb3-391"><a href="#cb3-391"></a>		<span class="kw">egen</span> t1       = <span class="kw">mean</span>(naics87), <span class="kw">by</span>(hs<span class="ot">`x'</span>)
</span>
<span id="cb3-392"><a href="#cb3-392"></a>		<span class="kw">egen</span> t2       = <span class="fu">sd</span>(naics87), <span class="kw">by</span>(hs<span class="ot">`x'</span>)
</span>
<span id="cb3-393"><a href="#cb3-393"></a>		<span class="kw">egen</span> t3       = <span class="fu">count</span>(naics87), <span class="kw">by</span>(hs<span class="ot">`x'</span>)
</span>
<span id="cb3-394"><a href="#cb3-394"></a>		<span class="kw">gen</span> naics87_<span class="ot">`x'</span> = t1 <span class="kw">if</span> t2==0 | t3==1
</span>
<span id="cb3-395"><a href="#cb3-395"></a>		<span class="kw">replace</span> naics87_new1 = naics87_<span class="ot">`x'</span> <span class="kw">if</span> naics87==. &amp; naics87_new1==.
</span>
<span id="cb3-396"><a href="#cb3-396"></a>		<span class="kw">drop</span> t1 t2 t3
</span>
<span id="cb3-397"><a href="#cb3-397"></a>		<span class="kw">drop</span> hs<span class="ot">`x'</span> naics87_<span class="ot">`x'</span>
</span>
<span id="cb3-398"><a href="#cb3-398"></a>	  } 
</span>
<span id="cb3-399"><a href="#cb3-399"></a>	}
</span>
<span id="cb3-400"><a href="#cb3-400"></a>	<span class="kw">sum</span> hs naics87 naics87_new1
</span>
<span id="cb3-401"><a href="#cb3-401"></a>	<span class="kw">sort</span> hs
</span>
<span id="cb3-402"><a href="#cb3-402"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp_02, replace
</span>
<span id="cb3-403"><a href="#cb3-403"></a>	
</span>
<span id="cb3-404"><a href="#cb3-404"></a>	*Second Mechanical Match
</span>
<span id="cb3-405"><a href="#cb3-405"></a>	*Sort HS codes.  For unmatched HS codes (<span class="kw">or</span> contiguous groups <span class="kw">of</span> HS10
</span>
<span id="cb3-406"><a href="#cb3-406"></a>	*codes), look <span class="fu">at</span> the matched HS10 codes that precede and follow.  If
</span>
<span id="cb3-407"><a href="#cb3-407"></a>	*matches <span class="kw">for</span> preceding and following HS10 codes are identical, assign
</span>
<span id="cb3-408"><a href="#cb3-408"></a>	*that NAICS code to the unmatched HS code(<span class="fu">s</span>).
</span>
<span id="cb3-409"><a href="#cb3-409"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_02, clear
</span>
<span id="cb3-410"><a href="#cb3-410"></a>	<span class="kw">gen</span> naics87_new2 = naics87_new1
</span>
<span id="cb3-411"><a href="#cb3-411"></a>	<span class="kw">gen</span> <span class="kw">begin</span>      = 1 <span class="kw">if</span> naics87_new1==. &amp; naics87_new1[<span class="dt">_n</span>-1]~=.
</span>
<span id="cb3-412"><a href="#cb3-412"></a>	<span class="kw">gen</span> <span class="kw">end</span>        = naics87_new1==. &amp; naics87_new1[<span class="dt">_n</span>+1]~=.
</span>
<span id="cb3-413"><a href="#cb3-413"></a>	<span class="kw">gen</span> bsum       = <span class="kw">sum</span>(<span class="kw">begin</span>)
</span>
<span id="cb3-414"><a href="#cb3-414"></a>	<span class="kw">gen</span> gap        = naics87_new1==.
</span>
<span id="cb3-415"><a href="#cb3-415"></a>	<span class="kw">replace</span> bsum=. <span class="kw">if</span> gap==0
</span>
<span id="cb3-416"><a href="#cb3-416"></a>	<span class="kw">gen</span> sb         = naics87_new1[<span class="dt">_n</span>-1]*begin
</span>
<span id="cb3-417"><a href="#cb3-417"></a>	<span class="kw">gen</span> se         = naics87_new1[<span class="dt">_n</span>+1]*end
</span>
<span id="cb3-418"><a href="#cb3-418"></a>	<span class="kw">egen</span> tb        = <span class="kw">mean</span>(sb), <span class="kw">by</span>(bsum)
</span>
<span id="cb3-419"><a href="#cb3-419"></a>	<span class="kw">egen</span> <span class="kw">te</span>        = <span class="kw">mean</span>(se), <span class="kw">by</span>(bsum)
</span>
<span id="cb3-420"><a href="#cb3-420"></a>	<span class="kw">gen</span> <span class="fu">match</span>      = tb==te
</span>
<span id="cb3-421"><a href="#cb3-421"></a>	<span class="kw">replace</span> naics87_new2 = tb <span class="kw">if</span> <span class="fu">match</span>==1 &amp; naics87_new1==.
</span>
<span id="cb3-422"><a href="#cb3-422"></a>	<span class="kw">sum</span> hs naics87*
</span>
<span id="cb3-423"><a href="#cb3-423"></a>	<span class="kw">drop</span> <span class="kw">begin</span> <span class="kw">end</span> bsum gap sb se tb <span class="kw">te</span> match
</span>
<span id="cb3-424"><a href="#cb3-424"></a>	<span class="kw">sort</span> hs
</span>
<span id="cb3-425"><a href="#cb3-425"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>temp_03, replace
</span>
<span id="cb3-426"><a href="#cb3-426"></a>	
</span>
<span id="cb3-427"><a href="#cb3-427"></a>	*Merge <span class="kw">in</span> <span class="st">"group"</span> codes created above, which are only used <span class="kw">for</span> labeling.
</span>
<span id="cb3-428"><a href="#cb3-428"></a>	<span class="kw">use</span> <span class="ot">`zzz'</span>temp_03, clear
</span>
<span id="cb3-429"><a href="#cb3-429"></a>	<span class="kw">sort</span> naics87_new1
</span>
<span id="cb3-430"><a href="#cb3-430"></a>	<span class="kw">merge</span> naics87_new1 <span class="kw">using</span> <span class="ot">`zzz'</span>temp1, <span class="kw">keep</span>(naics_new1)
</span>
<span id="cb3-431"><a href="#cb3-431"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-432"><a href="#cb3-432"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-433"><a href="#cb3-433"></a>	<span class="kw">sort</span> naics87_new2
</span>
<span id="cb3-434"><a href="#cb3-434"></a>	<span class="kw">merge</span> naics87_new2 <span class="kw">using</span> <span class="ot">`zzz'</span>temp2, <span class="kw">keep</span>(naics_new2)
</span>
<span id="cb3-435"><a href="#cb3-435"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-436"><a href="#cb3-436"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-437"><a href="#cb3-437"></a>	<span class="kw">sort</span> hs
</span>
<span id="cb3-438"><a href="#cb3-438"></a>	<span class="kw">gen</span> t=naics87_new1~=.
</span>
<span id="cb3-439"><a href="#cb3-439"></a>	<span class="kw">tab</span> t
</span>
<span id="cb3-440"><a href="#cb3-440"></a>	<span class="kw">drop</span> t 
</span>
<span id="cb3-441"><a href="#cb3-441"></a>      <span class="kw">drop</span> naics87*
</span>
<span id="cb3-442"><a href="#cb3-442"></a>	<span class="kw">format</span> hs %15.0g
</span>
<span id="cb3-443"><a href="#cb3-443"></a>	<span class="kw">drop</span> <span class="kw">if</span> hs&lt;100
</span>
<span id="cb3-444"><a href="#cb3-444"></a>	<span class="kw">save</span> <span class="ot">`zzz'</span>_concord_89_117_naicsfillin, replace
</span>
<span id="cb3-445"><a href="#cb3-445"></a>}
</span>
<span id="cb3-446"><a href="#cb3-446"></a>
</span>
<span id="cb3-447"><a href="#cb3-447"></a>
</span>
<span id="cb3-448"><a href="#cb3-448"></a>
</span>
<span id="cb3-449"><a href="#cb3-449"></a>**3 Add <span class="kw">in</span> hand matches to imports and exports, respectively, first <span class="kw">for</span> sic and then <span class="kw">for</span> naics
</span>
<span id="cb3-450"><a href="#cb3-450"></a>*  Any <span class="fu">missing</span> matches after the <span class="fu">last</span> section were matched <span class="kw">by</span> hand <span class="kw">by</span> kitjawat. Add these
</span>
<span id="cb3-451"><a href="#cb3-451"></a>*  hand matches into the <span class="kw">data</span> here and then also create a <span class="kw">variable</span> that identifies each 
</span>
<span id="cb3-452"><a href="#cb3-452"></a>* mapping according to whether it is from Census, mechanical <span class="fu">match</span> 1, mechanical <span class="fu">match</span> 2 or
</span>
<span id="cb3-453"><a href="#cb3-453"></a>*  from kitjawat's hand matching. 
</span>
<span id="cb3-454"><a href="#cb3-454"></a>*
</span>
<span id="cb3-455"><a href="#cb3-455"></a>*  2009.10.16 change sic 2612 to 2621 <span class="kw">in</span> kitjawat_handmatch_imports_sic_20080821 per Justin's email
</span>
<span id="cb3-456"><a href="#cb3-456"></a>*  also add leading <span class="bn">zero</span> to sics from handmatch and fix <span class="fu">missing</span> naics <span class="kw">for</span> 1605106000
</span>
<span id="cb3-457"><a href="#cb3-457"></a>*
</span>
<span id="cb3-458"><a href="#cb3-458"></a>
</span>
<span id="cb3-459"><a href="#cb3-459"></a>
</span>
<span id="cb3-460"><a href="#cb3-460"></a>*imports
</span>
<span id="cb3-461"><a href="#cb3-461"></a>cd <span class="st">"$C"</span>
</span>
<span id="cb3-462"><a href="#cb3-462"></a><span class="kw">use</span> interim/m_concord_89_117_sicfillin, clear
</span>
<span id="cb3-463"><a href="#cb3-463"></a><span class="kw">sort</span> hs
</span>
<span id="cb3-464"><a href="#cb3-464"></a><span class="kw">merge</span> hs <span class="kw">using</span> input/kitjawat_handmatch_imports_sic_20080821
</span>
<span id="cb3-465"><a href="#cb3-465"></a><span class="kw">tab</span> _merge
</span>
<span id="cb3-466"><a href="#cb3-466"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="dt">_merge</span>==2
</span>
<span id="cb3-467"><a href="#cb3-467"></a>*Correction <span class="kw">of</span> typo
</span>
<span id="cb3-468"><a href="#cb3-468"></a><span class="kw">replace</span> kitjawat = 2621 <span class="kw">if</span> kitjawat==2612
</span>
<span id="cb3-469"><a href="#cb3-469"></a><span class="kw">drop</span> _merge
</span>
<span id="cb3-470"><a href="#cb3-470"></a><span class="kw">tostring</span> kitjawat, g(kitjawats)
</span>
<span id="cb3-471"><a href="#cb3-471"></a><span class="kw">replace</span> kitjawats = <span class="st">"0"</span>+kitjawats <span class="kw">if</span> kitjawat&gt;=100 &amp; kitjawat&lt;=999 
</span>
<span id="cb3-472"><a href="#cb3-472"></a><span class="kw">gen</span> id         = <span class="st">"From Census"</span>
</span>
<span id="cb3-473"><a href="#cb3-473"></a><span class="kw">gen</span> newsic     = sic
</span>
<span id="cb3-474"><a href="#cb3-474"></a><span class="kw">replace</span> id     = <span class="st">"From mechanical match 1"</span> <span class="kw">if</span> sic==<span class="st">""</span>
</span>
<span id="cb3-475"><a href="#cb3-475"></a><span class="kw">replace</span> newsic = sic_new1 <span class="kw">if</span> sic==<span class="st">""</span>
</span>
<span id="cb3-476"><a href="#cb3-476"></a><span class="kw">replace</span> id     = <span class="st">"From mechanical match 2"</span> <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-477"><a href="#cb3-477"></a><span class="kw">replace</span> newsic = sic_new2 <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-478"><a href="#cb3-478"></a><span class="kw">replace</span> id     = <span class="st">"From hand match"</span> <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-479"><a href="#cb3-479"></a><span class="kw">replace</span> newsic = kitjawats <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-480"><a href="#cb3-480"></a><span class="kw">label</span> <span class="kw">var</span> id <span class="st">"SIC match type"</span>
</span>
<span id="cb3-481"><a href="#cb3-481"></a><span class="kw">keep</span> commodity hs newsic id
</span>
<span id="cb3-482"><a href="#cb3-482"></a><span class="kw">rename</span> newsic sic 
</span>
<span id="cb3-483"><a href="#cb3-483"></a><span class="kw">rename</span> id sic_matchtype
</span>
<span id="cb3-484"><a href="#cb3-484"></a><span class="kw">rename</span> sic new_sic
</span>
<span id="cb3-485"><a href="#cb3-485"></a><span class="kw">keep</span> commodity new_sic sic_matchtype
</span>
<span id="cb3-486"><a href="#cb3-486"></a><span class="kw">order</span> commodity new_sic sic_matchtype
</span>
<span id="cb3-487"><a href="#cb3-487"></a><span class="kw">sort</span> commodity
</span>
<span id="cb3-488"><a href="#cb3-488"></a><span class="kw">save</span> interim/sic_m_final, replace
</span>
<span id="cb3-489"><a href="#cb3-489"></a>
</span>
<span id="cb3-490"><a href="#cb3-490"></a>cd <span class="st">"$C"</span>
</span>
<span id="cb3-491"><a href="#cb3-491"></a><span class="kw">use</span> interim/m_concord_89_117_naicsfillin, clear
</span>
<span id="cb3-492"><a href="#cb3-492"></a><span class="kw">sort</span> hs
</span>
<span id="cb3-493"><a href="#cb3-493"></a><span class="kw">merge</span> hs <span class="kw">using</span> input/kitjawat_handmatch_imports_naics_20081016
</span>
<span id="cb3-494"><a href="#cb3-494"></a><span class="kw">tab</span> _merge
</span>
<span id="cb3-495"><a href="#cb3-495"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="dt">_merge</span>==2
</span>
<span id="cb3-496"><a href="#cb3-496"></a><span class="kw">drop</span> _merge
</span>
<span id="cb3-497"><a href="#cb3-497"></a><span class="kw">tostring</span> kitjawat, g(kitjawats)
</span>
<span id="cb3-498"><a href="#cb3-498"></a>*Correct typo
</span>
<span id="cb3-499"><a href="#cb3-499"></a><span class="kw">replace</span> kitjawats = <span class="st">"311711"</span> <span class="kw">if</span> commodity==1605106000
</span>
<span id="cb3-500"><a href="#cb3-500"></a><span class="kw">gen</span> id           = <span class="st">"From Census"</span>
</span>
<span id="cb3-501"><a href="#cb3-501"></a><span class="kw">gen</span> newnaics     = naics
</span>
<span id="cb3-502"><a href="#cb3-502"></a><span class="kw">replace</span> id       = <span class="st">"From mechanical match 1"</span> <span class="kw">if</span> naics==<span class="st">""</span>
</span>
<span id="cb3-503"><a href="#cb3-503"></a><span class="kw">replace</span> newnaics = naics_new1 <span class="kw">if</span> naics==<span class="st">""</span>
</span>
<span id="cb3-504"><a href="#cb3-504"></a><span class="kw">replace</span> id       = <span class="st">"From mechanical match 2"</span> <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-505"><a href="#cb3-505"></a><span class="kw">replace</span> newnaics = naics_new2 <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-506"><a href="#cb3-506"></a><span class="kw">replace</span> id       = <span class="st">"From hand match"</span> <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-507"><a href="#cb3-507"></a><span class="kw">replace</span> newnaics = kitjawats <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-508"><a href="#cb3-508"></a><span class="kw">label</span> <span class="kw">var</span> id <span class="st">"NAICS match type"</span>
</span>
<span id="cb3-509"><a href="#cb3-509"></a><span class="kw">drop</span> naics
</span>
<span id="cb3-510"><a href="#cb3-510"></a><span class="kw">rename</span> newnaics naics 
</span>
<span id="cb3-511"><a href="#cb3-511"></a><span class="kw">rename</span> id naics_matchtype
</span>
<span id="cb3-512"><a href="#cb3-512"></a><span class="kw">rename</span> naics new_naics
</span>
<span id="cb3-513"><a href="#cb3-513"></a><span class="kw">keep</span> commodity new_naics naics_matchtype
</span>
<span id="cb3-514"><a href="#cb3-514"></a><span class="kw">order</span> commodity new_naics naics_matchtype
</span>
<span id="cb3-515"><a href="#cb3-515"></a><span class="kw">sort</span> commodity
</span>
<span id="cb3-516"><a href="#cb3-516"></a><span class="kw">save</span> interim/naics_m_final, replace
</span>
<span id="cb3-517"><a href="#cb3-517"></a>
</span>
<span id="cb3-518"><a href="#cb3-518"></a>
</span>
<span id="cb3-519"><a href="#cb3-519"></a>*exports
</span>
<span id="cb3-520"><a href="#cb3-520"></a>cd <span class="st">"$C"</span>
</span>
<span id="cb3-521"><a href="#cb3-521"></a><span class="kw">use</span> interim/x_concord_89_117_sicfillin, clear
</span>
<span id="cb3-522"><a href="#cb3-522"></a><span class="kw">sort</span> hs
</span>
<span id="cb3-523"><a href="#cb3-523"></a><span class="kw">merge</span> hs <span class="kw">using</span> input/kitjawat_handmatch_exports_sic_20080821
</span>
<span id="cb3-524"><a href="#cb3-524"></a><span class="kw">tab</span> _merge
</span>
<span id="cb3-525"><a href="#cb3-525"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="dt">_merge</span>==2
</span>
<span id="cb3-526"><a href="#cb3-526"></a><span class="kw">drop</span> _merge
</span>
<span id="cb3-527"><a href="#cb3-527"></a><span class="kw">tostring</span> kitjawat, g(kitjawats)
</span>
<span id="cb3-528"><a href="#cb3-528"></a><span class="kw">replace</span> kitjawats = <span class="st">"0"</span>+kitjawats <span class="kw">if</span> kitjawat&gt;=100 &amp; kitjawat&lt;=999 
</span>
<span id="cb3-529"><a href="#cb3-529"></a><span class="kw">gen</span> id         = <span class="st">"From Census"</span>
</span>
<span id="cb3-530"><a href="#cb3-530"></a><span class="kw">gen</span> newsic     = sic
</span>
<span id="cb3-531"><a href="#cb3-531"></a><span class="kw">replace</span> id     = <span class="st">"From mechanical match 1"</span> <span class="kw">if</span> sic==<span class="st">""</span>
</span>
<span id="cb3-532"><a href="#cb3-532"></a><span class="kw">replace</span> newsic = sic_new1 <span class="kw">if</span> sic==<span class="st">""</span>
</span>
<span id="cb3-533"><a href="#cb3-533"></a><span class="kw">replace</span> id     = <span class="st">"From mechanical match 2"</span> <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-534"><a href="#cb3-534"></a><span class="kw">replace</span> newsic = sic_new2 <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-535"><a href="#cb3-535"></a><span class="kw">replace</span> id     = <span class="st">"From hand match"</span> <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-536"><a href="#cb3-536"></a><span class="kw">replace</span> newsic = kitjawats <span class="kw">if</span> newsic==<span class="st">""</span>
</span>
<span id="cb3-537"><a href="#cb3-537"></a><span class="kw">label</span> <span class="kw">var</span> id <span class="st">"SIC match type"</span>
</span>
<span id="cb3-538"><a href="#cb3-538"></a><span class="kw">drop</span> sic
</span>
<span id="cb3-539"><a href="#cb3-539"></a><span class="kw">rename</span> newsic sic 
</span>
<span id="cb3-540"><a href="#cb3-540"></a><span class="kw">rename</span> id sic_matchtype
</span>
<span id="cb3-541"><a href="#cb3-541"></a><span class="kw">rename</span> sic new_sic
</span>
<span id="cb3-542"><a href="#cb3-542"></a><span class="kw">keep</span> commodity new_sic sic_matchtype
</span>
<span id="cb3-543"><a href="#cb3-543"></a><span class="kw">order</span> commodity new_sic sic_matchtype
</span>
<span id="cb3-544"><a href="#cb3-544"></a><span class="kw">sort</span> commodity
</span>
<span id="cb3-545"><a href="#cb3-545"></a><span class="kw">save</span> interim/sic_x_final, replace
</span>
<span id="cb3-546"><a href="#cb3-546"></a>
</span>
<span id="cb3-547"><a href="#cb3-547"></a>cd <span class="st">"$C"</span>
</span>
<span id="cb3-548"><a href="#cb3-548"></a><span class="kw">use</span> interim/x_concord_89_117_naicsfillin, clear
</span>
<span id="cb3-549"><a href="#cb3-549"></a><span class="kw">sort</span> hs
</span>
<span id="cb3-550"><a href="#cb3-550"></a><span class="kw">merge</span> hs <span class="kw">using</span> input/kitjawat_handmatch_exports_naics_20081016
</span>
<span id="cb3-551"><a href="#cb3-551"></a><span class="kw">tab</span> _merge
</span>
<span id="cb3-552"><a href="#cb3-552"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="dt">_merge</span>==2
</span>
<span id="cb3-553"><a href="#cb3-553"></a><span class="kw">drop</span> _merge
</span>
<span id="cb3-554"><a href="#cb3-554"></a><span class="kw">tostring</span> kitjawat, g(kitjawats)
</span>
<span id="cb3-555"><a href="#cb3-555"></a><span class="kw">gen</span> id           = <span class="st">"From Census"</span>
</span>
<span id="cb3-556"><a href="#cb3-556"></a><span class="kw">gen</span> newnaics     = naics
</span>
<span id="cb3-557"><a href="#cb3-557"></a><span class="kw">replace</span> id       = <span class="st">"From mechanical match 1"</span> <span class="kw">if</span> naics==<span class="st">""</span>
</span>
<span id="cb3-558"><a href="#cb3-558"></a><span class="kw">replace</span> newnaics = naics_new1 <span class="kw">if</span> naics==<span class="st">""</span>
</span>
<span id="cb3-559"><a href="#cb3-559"></a><span class="kw">replace</span> id       = <span class="st">"From mechanical match 2"</span> <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-560"><a href="#cb3-560"></a><span class="kw">replace</span> newnaics = naics_new2 <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-561"><a href="#cb3-561"></a><span class="kw">replace</span> id       = <span class="st">"From hand match"</span> <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-562"><a href="#cb3-562"></a><span class="kw">replace</span> newnaics = kitjawats <span class="kw">if</span> newnaics==<span class="st">""</span>
</span>
<span id="cb3-563"><a href="#cb3-563"></a><span class="kw">label</span> <span class="kw">var</span> id <span class="st">"NAICS match type"</span>
</span>
<span id="cb3-564"><a href="#cb3-564"></a><span class="kw">drop</span> naics
</span>
<span id="cb3-565"><a href="#cb3-565"></a><span class="kw">rename</span> newnaics naics 
</span>
<span id="cb3-566"><a href="#cb3-566"></a><span class="kw">rename</span> id naics_matchtype
</span>
<span id="cb3-567"><a href="#cb3-567"></a><span class="kw">rename</span> naics new_naics
</span>
<span id="cb3-568"><a href="#cb3-568"></a><span class="kw">keep</span> commodity new_naics naics_matchtype
</span>
<span id="cb3-569"><a href="#cb3-569"></a><span class="kw">order</span> commodity new_naics naics_matchtype
</span>
<span id="cb3-570"><a href="#cb3-570"></a><span class="kw">sort</span> commodity
</span>
<span id="cb3-571"><a href="#cb3-571"></a><span class="kw">save</span> interim/naics_x_final, replace
</span>
<span id="cb3-572"><a href="#cb3-572"></a>
</span>
<span id="cb3-573"><a href="#cb3-573"></a>
</span>
<span id="cb3-574"><a href="#cb3-574"></a>
</span>
<span id="cb3-575"><a href="#cb3-575"></a>**4 Check how many naics are <span class="kw">in</span> concordance but <span class="kw">not</span> official <span class="ot">list</span>, and vice versa.
</span>
<span id="cb3-576"><a href="#cb3-576"></a>*Then, create a <span class="kw">new</span> NAICS code, NAICSX, that <span class="kw">for</span> a given parent will <span class="kw">replace</span> all
</span>
<span id="cb3-577"><a href="#cb3-577"></a>*children's codes with the parent root and X(<span class="fu">s</span>) <span class="kw">if</span> one <span class="kw">or</span> <span class="kw">more</span> children are <span class="fu">missing</span> from 
</span>
<span id="cb3-578"><a href="#cb3-578"></a>*the census concordances.
</span>
<span id="cb3-579"><a href="#cb3-579"></a>*
</span>
<span id="cb3-580"><a href="#cb3-580"></a>*
</span>
<span id="cb3-581"><a href="#cb3-581"></a>
</span>
<span id="cb3-582"><a href="#cb3-582"></a>*4.0 Assemble full <span class="ot">list</span> <span class="kw">of</span> naics codes <span class="kw">by</span> vintage
</span>
<span id="cb3-583"><a href="#cb3-583"></a>*
</span>
<span id="cb3-584"><a href="#cb3-584"></a>*	Assume here that:
</span>
<span id="cb3-585"><a href="#cb3-585"></a>*	
</span>
<span id="cb3-586"><a href="#cb3-586"></a>*		1997 codes used from 1989-2001
</span>
<span id="cb3-587"><a href="#cb3-587"></a>*		2002 codes used from 2002-2006
</span>
<span id="cb3-588"><a href="#cb3-588"></a>*		2007 codes used from 2007-2012
</span>
<span id="cb3-589"><a href="#cb3-589"></a>*		2012 codes used from 2013-2017
</span>
<span id="cb3-590"><a href="#cb3-590"></a>*		2017 codes used <span class="kw">for</span> 2017
</span>
<span id="cb3-591"><a href="#cb3-591"></a>*
</span>
<span id="cb3-592"><a href="#cb3-592"></a>* 		List <span class="kw">of</span> NAICS codes avaialable <span class="fu">at</span>:
</span>
<span id="cb3-593"><a href="#cb3-593"></a>*		https:<span class="co">//www.census.gov/eos/www/naics/concordances/concordances.html
</span></span>
<span id="cb3-594"><a href="#cb3-594"></a>*
</span>
<span id="cb3-595"><a href="#cb3-595"></a>*
</span>
<span id="cb3-596"><a href="#cb3-596"></a>
</span>
<span id="cb3-597"><a href="#cb3-597"></a>*6-digit
</span>
<span id="cb3-598"><a href="#cb3-598"></a>cd <span class="st">"$NC"</span>
</span>
<span id="cb3-599"><a href="#cb3-599"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">in</span> 1989  {
</span>
<span id="cb3-600"><a href="#cb3-600"></a>	<span class="kw">use</span> naics_1997, clear
</span>
<span id="cb3-601"><a href="#cb3-601"></a>	<span class="kw">duplicates</span> drop
</span>
<span id="cb3-602"><a href="#cb3-602"></a>	<span class="kw">gen</span> <span class="fu">year</span>=1989
</span>
<span id="cb3-603"><a href="#cb3-603"></a>	<span class="kw">forvalues</span> c=1/7 {
</span>
<span id="cb3-604"><a href="#cb3-604"></a>		<span class="kw">append</span> <span class="kw">using</span> naics_1997
</span>
<span id="cb3-605"><a href="#cb3-605"></a>		<span class="kw">replace</span> <span class="fu">year</span>=<span class="ot">`y'</span>+<span class="ot">`c'</span> <span class="kw">if</span> <span class="fu">year</span>==.
</span>
<span id="cb3-606"><a href="#cb3-606"></a>	}
</span>
<span id="cb3-607"><a href="#cb3-607"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics97==.
</span>
<span id="cb3-608"><a href="#cb3-608"></a>	<span class="kw">save</span> naics_1989_year, replace
</span>
<span id="cb3-609"><a href="#cb3-609"></a>}
</span>
<span id="cb3-610"><a href="#cb3-610"></a><span class="kw">tab</span> year
</span>
<span id="cb3-611"><a href="#cb3-611"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">in</span> 1997 2002  {
</span>
<span id="cb3-612"><a href="#cb3-612"></a>	<span class="kw">use</span> naics_<span class="ot">`y'</span>, clear
</span>
<span id="cb3-613"><a href="#cb3-613"></a>	<span class="kw">duplicates</span> drop
</span>
<span id="cb3-614"><a href="#cb3-614"></a>	<span class="kw">gen</span> <span class="fu">year</span>=<span class="ot">`y'</span>
</span>
<span id="cb3-615"><a href="#cb3-615"></a>	<span class="kw">forvalues</span> c=1/4 {
</span>
<span id="cb3-616"><a href="#cb3-616"></a>		<span class="kw">append</span> <span class="kw">using</span> naics_<span class="ot">`y'</span>
</span>
<span id="cb3-617"><a href="#cb3-617"></a>		<span class="kw">replace</span> <span class="fu">year</span>=<span class="ot">`y'</span>+<span class="ot">`c'</span> <span class="kw">if</span> <span class="fu">year</span>==.
</span>
<span id="cb3-618"><a href="#cb3-618"></a>	}
</span>
<span id="cb3-619"><a href="#cb3-619"></a>	<span class="kw">capture</span> <span class="kw">drop</span> <span class="kw">if</span> naics97==.
</span>
<span id="cb3-620"><a href="#cb3-620"></a>	<span class="kw">capture</span> <span class="kw">drop</span> <span class="kw">if</span> naics02==.
</span>
<span id="cb3-621"><a href="#cb3-621"></a>	<span class="kw">save</span> naics_<span class="ot">`y'</span>_year, replace
</span>
<span id="cb3-622"><a href="#cb3-622"></a>}
</span>
<span id="cb3-623"><a href="#cb3-623"></a><span class="kw">tab</span> year
</span>
<span id="cb3-624"><a href="#cb3-624"></a>cd <span class="st">"$NC"</span>
</span>
<span id="cb3-625"><a href="#cb3-625"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">in</span> 2007  {
</span>
<span id="cb3-626"><a href="#cb3-626"></a>	<span class="kw">use</span> naics_2007, <span class="kw">clear</span>			<span class="co">/*end 2007 a year later*/</span>
</span>
<span id="cb3-627"><a href="#cb3-627"></a>	<span class="kw">duplicates</span> drop
</span>
<span id="cb3-628"><a href="#cb3-628"></a>	<span class="kw">gen</span> <span class="fu">year</span>=2007
</span>
<span id="cb3-629"><a href="#cb3-629"></a>	<span class="kw">forvalues</span> c=1/5 {
</span>
<span id="cb3-630"><a href="#cb3-630"></a>		<span class="kw">append</span> <span class="kw">using</span> naics_2007
</span>
<span id="cb3-631"><a href="#cb3-631"></a>		<span class="kw">replace</span> <span class="fu">year</span>=<span class="ot">`y'</span>+<span class="ot">`c'</span> <span class="kw">if</span> <span class="fu">year</span>==.
</span>
<span id="cb3-632"><a href="#cb3-632"></a>	}
</span>
<span id="cb3-633"><a href="#cb3-633"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics07==.
</span>
<span id="cb3-634"><a href="#cb3-634"></a>	<span class="kw">save</span> naics_2007_year, replace
</span>
<span id="cb3-635"><a href="#cb3-635"></a>}
</span>
<span id="cb3-636"><a href="#cb3-636"></a><span class="kw">tab</span> year
</span>
<span id="cb3-637"><a href="#cb3-637"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">in</span> 2012  {
</span>
<span id="cb3-638"><a href="#cb3-638"></a>	<span class="kw">use</span> naics_2012, <span class="kw">clear</span>			<span class="co">/*start 2012 a year late*/</span>
</span>
<span id="cb3-639"><a href="#cb3-639"></a>	<span class="kw">duplicates</span> drop
</span>
<span id="cb3-640"><a href="#cb3-640"></a>	<span class="kw">gen</span> <span class="fu">year</span>=2013
</span>
<span id="cb3-641"><a href="#cb3-641"></a>	<span class="kw">forvalues</span> c=1/4 {
</span>
<span id="cb3-642"><a href="#cb3-642"></a>		<span class="kw">append</span> <span class="kw">using</span> naics_2012
</span>
<span id="cb3-643"><a href="#cb3-643"></a>		<span class="kw">replace</span> <span class="fu">year</span>=<span class="ot">`y'</span>+<span class="ot">`c'</span> <span class="kw">if</span> <span class="fu">year</span>==.
</span>
<span id="cb3-644"><a href="#cb3-644"></a>	}
</span>
<span id="cb3-645"><a href="#cb3-645"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics12==.
</span>
<span id="cb3-646"><a href="#cb3-646"></a>	<span class="kw">save</span> naics_2012_year, replace
</span>
<span id="cb3-647"><a href="#cb3-647"></a>}
</span>
<span id="cb3-648"><a href="#cb3-648"></a><span class="kw">tab</span> year
</span>
<span id="cb3-649"><a href="#cb3-649"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">in</span> 2017  {
</span>
<span id="cb3-650"><a href="#cb3-650"></a>	<span class="kw">use</span> naics_2017, <span class="kw">clear</span>			<span class="co">/*start 2012 a year late*/</span>
</span>
<span id="cb3-651"><a href="#cb3-651"></a>	<span class="kw">duplicates</span> drop
</span>
<span id="cb3-652"><a href="#cb3-652"></a>	<span class="kw">gen</span> <span class="fu">year</span>=2017
</span>
<span id="cb3-653"><a href="#cb3-653"></a>	<span class="kw">drop</span> <span class="kw">if</span> naics17==.
</span>
<span id="cb3-654"><a href="#cb3-654"></a>	<span class="kw">save</span> naics_2017_year, replace
</span>
<span id="cb3-655"><a href="#cb3-655"></a>}
</span>
<span id="cb3-656"><a href="#cb3-656"></a><span class="kw">tab</span> year
</span>
<span id="cb3-657"><a href="#cb3-657"></a>
</span>
<span id="cb3-658"><a href="#cb3-658"></a><span class="kw">use</span> naics_1989_year, clear
</span>
<span id="cb3-659"><a href="#cb3-659"></a><span class="kw">append</span> <span class="kw">using</span> naics_1997_year
</span>
<span id="cb3-660"><a href="#cb3-660"></a><span class="kw">rename</span> naics97 naics02
</span>
<span id="cb3-661"><a href="#cb3-661"></a><span class="kw">append</span> <span class="kw">using</span> naics_2002_year
</span>
<span id="cb3-662"><a href="#cb3-662"></a><span class="kw">rename</span> naics02 naics07
</span>
<span id="cb3-663"><a href="#cb3-663"></a><span class="kw">append</span> <span class="kw">using</span> naics_2007_year
</span>
<span id="cb3-664"><a href="#cb3-664"></a><span class="kw">rename</span> naics07 naics12
</span>
<span id="cb3-665"><a href="#cb3-665"></a><span class="kw">append</span> <span class="kw">using</span> naics_2012_year
</span>
<span id="cb3-666"><a href="#cb3-666"></a><span class="kw">rename</span> naics12 naics17
</span>
<span id="cb3-667"><a href="#cb3-667"></a><span class="kw">append</span> <span class="kw">using</span> naics_2017_year
</span>
<span id="cb3-668"><a href="#cb3-668"></a><span class="kw">rename</span> naics17 naics
</span>
<span id="cb3-669"><a href="#cb3-669"></a>
</span>
<span id="cb3-670"><a href="#cb3-670"></a><span class="kw">drop</span> <span class="bn">title</span>*
</span>
<span id="cb3-671"><a href="#cb3-671"></a><span class="kw">drop</span> *title
</span>
<span id="cb3-672"><a href="#cb3-672"></a><span class="kw">gen</span> i = 1
</span>
<span id="cb3-673"><a href="#cb3-673"></a><span class="kw">rename</span> naics nnaics
</span>
<span id="cb3-674"><a href="#cb3-674"></a><span class="kw">tostring</span> nnaics, <span class="kw">force</span> g(naics)
</span>
<span id="cb3-675"><a href="#cb3-675"></a><span class="kw">duplicates</span> drop
</span>
<span id="cb3-676"><a href="#cb3-676"></a><span class="kw">save</span> naics_year, replace
</span>
<span id="cb3-677"><a href="#cb3-677"></a><span class="kw">tab</span> year
</span>
<span id="cb3-678"><a href="#cb3-678"></a>
</span>
<span id="cb3-679"><a href="#cb3-679"></a>*how many man codes <span class="kw">in</span> above
</span>
<span id="cb3-680"><a href="#cb3-680"></a><span class="kw">use</span> naics_year, clear
</span>
<span id="cb3-681"><a href="#cb3-681"></a><span class="kw">gen</span> man =<span class="fu">substr</span>(naics,1,1)==<span class="st">"3"</span>
</span>
<span id="cb3-682"><a href="#cb3-682"></a><span class="kw">egen</span> x = <span class="fu">tag</span>(naics <span class="fu">year</span>)
</span>
<span id="cb3-683"><a href="#cb3-683"></a><span class="kw">table</span> <span class="fu">year</span> <span class="kw">if</span> x, c(<span class="kw">sum</span> man)
</span>
<span id="cb3-684"><a href="#cb3-684"></a>
</span>
<span id="cb3-685"><a href="#cb3-685"></a>*5-digit
</span>
<span id="cb3-686"><a href="#cb3-686"></a>cd <span class="st">"$NC"</span>
</span>
<span id="cb3-687"><a href="#cb3-687"></a><span class="kw">use</span> naics_year, clear
</span>
<span id="cb3-688"><a href="#cb3-688"></a><span class="kw">keep</span> naics year
</span>
<span id="cb3-689"><a href="#cb3-689"></a><span class="kw">gen</span> naics5 = <span class="fu">substr</span>(naics,1,5)
</span>
<span id="cb3-690"><a href="#cb3-690"></a><span class="kw">keep</span> naics5 year
</span>
<span id="cb3-691"><a href="#cb3-691"></a><span class="kw">duplicates</span> drop
</span>
<span id="cb3-692"><a href="#cb3-692"></a><span class="kw">save</span> naics5_year, replace
</span>
<span id="cb3-693"><a href="#cb3-693"></a>
</span>
<span id="cb3-694"><a href="#cb3-694"></a>*4-digit
</span>
<span id="cb3-695"><a href="#cb3-695"></a>cd <span class="st">"$NC"</span>
</span>
<span id="cb3-696"><a href="#cb3-696"></a><span class="kw">use</span> naics_year, clear
</span>
<span id="cb3-697"><a href="#cb3-697"></a><span class="kw">gen</span> naics4 = <span class="fu">substr</span>(naics,1,4)
</span>
<span id="cb3-698"><a href="#cb3-698"></a><span class="kw">keep</span> naics4 year
</span>
<span id="cb3-699"><a href="#cb3-699"></a><span class="kw">duplicates</span> drop
</span>
<span id="cb3-700"><a href="#cb3-700"></a><span class="kw">save</span> naics4_year, replace
</span>
<span id="cb3-701"><a href="#cb3-701"></a>
</span>
<span id="cb3-702"><a href="#cb3-702"></a>
</span>
<span id="cb3-703"><a href="#cb3-703"></a>
</span>
<span id="cb3-704"><a href="#cb3-704"></a>
</span>
<span id="cb3-705"><a href="#cb3-705"></a>
</span>
<span id="cb3-706"><a href="#cb3-706"></a>*4.1 Merge official NAICS lists assembled above into HS-NAICS concordance
</span>
<span id="cb3-707"><a href="#cb3-707"></a><span class="kw">foreach</span> t <span class="kw">in</span> <span class="fu">m</span> x {
</span>
<span id="cb3-708"><a href="#cb3-708"></a>	cd <span class="st">"$C"</span>
</span>
<span id="cb3-709"><a href="#cb3-709"></a>	<span class="kw">use</span> interim/concord_<span class="ot">`t'</span>_1989_2017_abbreviated, clear
</span>
<span id="cb3-710"><a href="#cb3-710"></a>	<span class="kw">sort</span> commodity
</span>
<span id="cb3-711"><a href="#cb3-711"></a>	<span class="kw">merge</span> commodity <span class="kw">using</span> interim/sic_<span class="ot">`t'</span>_final
</span>
<span id="cb3-712"><a href="#cb3-712"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-713"><a href="#cb3-713"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-714"><a href="#cb3-714"></a>	<span class="kw">replace</span> sic_matchtype=<span class="st">"From Census"</span> <span class="kw">if</span> sic!=<span class="st">""</span>
</span>
<span id="cb3-715"><a href="#cb3-715"></a>	<span class="kw">replace</span> sic=new_sic <span class="kw">if</span> sic==<span class="st">""</span> &amp; new_sic!=<span class="st">""</span>
</span>
<span id="cb3-716"><a href="#cb3-716"></a>	<span class="kw">sort</span> commodity
</span>
<span id="cb3-717"><a href="#cb3-717"></a>	<span class="kw">merge</span> commodity <span class="kw">using</span> interim/naics_<span class="ot">`t'</span>_final
</span>
<span id="cb3-718"><a href="#cb3-718"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-719"><a href="#cb3-719"></a>	<span class="kw">drop</span> _merge
</span>
<span id="cb3-720"><a href="#cb3-720"></a>	<span class="kw">replace</span> naics_matchtype=<span class="st">"From Census"</span> <span class="kw">if</span> naics!=<span class="st">""</span>
</span>
<span id="cb3-721"><a href="#cb3-721"></a>	<span class="kw">replace</span> naics=new_naics <span class="kw">if</span> naics==<span class="st">""</span> &amp; new_naics!=<span class="st">""</span>
</span>
<span id="cb3-722"><a href="#cb3-722"></a>	<span class="kw">drop</span> <span class="kw">new</span>* 
</span>
<span id="cb3-723"><a href="#cb3-723"></a>	<span class="kw">destring</span> commodity, g(hs) force
</span>
<span id="cb3-724"><a href="#cb3-724"></a>	<span class="kw">drop</span> <span class="kw">if</span> commodity==.
</span>
<span id="cb3-725"><a href="#cb3-725"></a>	<span class="kw">order</span> commodity <span class="fu">year</span> sic sic_matchtype naics naics_matchtype
</span>
<span id="cb3-726"><a href="#cb3-726"></a>	<span class="kw">sort</span> commodity year
</span>
<span id="cb3-727"><a href="#cb3-727"></a>	<span class="kw">format</span> commodity %15.0fc
</span>
<span id="cb3-728"><a href="#cb3-728"></a>	<span class="kw">gen</span> <span class="kw">double</span> hs=commodity
</span>
<span id="cb3-729"><a href="#cb3-729"></a>	*Label which codes are only <span class="kw">in</span> trade concordances, only <span class="kw">in</span> official
</span>
<span id="cb3-730"><a href="#cb3-730"></a>	*NAICS <span class="ot">list</span>, <span class="kw">or</span> both
</span>
<span id="cb3-731"><a href="#cb3-731"></a>	<span class="kw">merge</span> <span class="fu">m</span>:1 naics <span class="fu">year</span> <span class="kw">using</span> input/naics/naics_year
</span>
<span id="cb3-732"><a href="#cb3-732"></a>	<span class="kw">egen</span> x = <span class="fu">tag</span>(naics <span class="fu">year</span>)
</span>
<span id="cb3-733"><a href="#cb3-733"></a>	<span class="kw">gen</span> man = <span class="fu">substr</span>(naics,1,1)==<span class="st">"3"</span>
</span>
<span id="cb3-734"><a href="#cb3-734"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-735"><a href="#cb3-735"></a>	<span class="kw">table</span> <span class="fu">year</span> <span class="dt">_merge</span> <span class="kw">if</span> x, c(<span class="kw">sum</span> man)
</span>
<span id="cb3-736"><a href="#cb3-736"></a>	<span class="kw">gen</span> naics_origin = <span class="st">""</span>
</span>
<span id="cb3-737"><a href="#cb3-737"></a>	<span class="kw">replace</span> naics_origin = <span class="st">"in concordance only"</span> <span class="kw">if</span> <span class="dt">_merge</span>==1
</span>
<span id="cb3-738"><a href="#cb3-738"></a>	<span class="kw">replace</span> naics_origin = <span class="st">"in official naics list only"</span> <span class="kw">if</span> <span class="dt">_merge</span>==2
</span>
<span id="cb3-739"><a href="#cb3-739"></a>	<span class="kw">replace</span> naics_origin = <span class="st">"in both concordance and official naics list"</span> <span class="kw">if</span> <span class="dt">_merge</span>==3
</span>
<span id="cb3-740"><a href="#cb3-740"></a>	
</span>
<span id="cb3-741"><a href="#cb3-741"></a>	*Create <span class="kw">variable</span> naicsX that replaces <span class="fu">last</span> character <span class="kw">of</span> NAICS with 
</span>
<span id="cb3-742"><a href="#cb3-742"></a>	*X <span class="kw">if</span> 5-digit parent is <span class="fu">missing</span> a child, where <span class="fu">missing</span> refers to
</span>
<span id="cb3-743"><a href="#cb3-743"></a>	*a NAICS codes that is <span class="kw">in</span> the official <span class="ot">list</span> but doesn't appear <span class="kw">in</span> the 
</span>
<span id="cb3-744"><a href="#cb3-744"></a>	*trade concordances from Census.
</span>
<span id="cb3-745"><a href="#cb3-745"></a>	<span class="kw">gen</span> naicsX = naics
</span>
<span id="cb3-746"><a href="#cb3-746"></a>	<span class="kw">gen</span> n5 = <span class="fu">substr</span>(naics,1,5)
</span>
<span id="cb3-747"><a href="#cb3-747"></a>	<span class="kw">gen</span> aa = _m==1
</span>
<span id="cb3-748"><a href="#cb3-748"></a>	<span class="kw">gen</span> bb = _m==2
</span>
<span id="cb3-749"><a href="#cb3-749"></a>	<span class="kw">gen</span> <span class="kw">cc</span> = aa | bb
</span>
<span id="cb3-750"><a href="#cb3-750"></a>	<span class="kw">egen</span> t0 = <span class="kw">total</span>(bb), <span class="kw">by</span>(n5 <span class="fu">year</span>)
</span>
<span id="cb3-751"><a href="#cb3-751"></a>	<span class="kw">replace</span> naicsX = n5+<span class="st">"X"</span> <span class="kw">if</span> t0~=0
</span>
<span id="cb3-752"><a href="#cb3-752"></a>	<span class="kw">sort</span> <span class="fu">year</span> naics
</span>
<span id="cb3-753"><a href="#cb3-753"></a>	<span class="kw">rename</span> <span class="dt">_merge</span> _merge6
</span>
<span id="cb3-754"><a href="#cb3-754"></a>	<span class="kw">drop</span> t0 n5 aa bb cc
</span>
<span id="cb3-755"><a href="#cb3-755"></a>
</span>
<span id="cb3-756"><a href="#cb3-756"></a>	*Go up a <span class="dv">level</span> <span class="kw">of</span> aggregation, (look <span class="kw">for</span> <span class="fu">missing</span> N5, within N4, and
</span>
<span id="cb3-757"><a href="#cb3-757"></a>	*change naicsX to N4+<span class="st">"XX"</span>
</span>
<span id="cb3-758"><a href="#cb3-758"></a>	<span class="kw">drop</span> <span class="kw">if</span> _merge6==2
</span>
<span id="cb3-759"><a href="#cb3-759"></a>	<span class="kw">gen</span> naics5 = <span class="fu">substr</span>(naics,1,5)
</span>
<span id="cb3-760"><a href="#cb3-760"></a>	<span class="kw">merge</span> <span class="fu">m</span>:1 naics5 <span class="fu">year</span> <span class="kw">using</span> input/naics/naics5_year
</span>
<span id="cb3-761"><a href="#cb3-761"></a>	<span class="kw">drop</span> x 
</span>
<span id="cb3-762"><a href="#cb3-762"></a>	<span class="kw">egen</span> x = <span class="fu">tag</span>(naics5 <span class="fu">year</span>)
</span>
<span id="cb3-763"><a href="#cb3-763"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-764"><a href="#cb3-764"></a>	<span class="kw">table</span> <span class="fu">year</span> <span class="dt">_merge</span> <span class="kw">if</span> x, c(<span class="kw">sum</span> man)
</span>
<span id="cb3-765"><a href="#cb3-765"></a>	<span class="kw">gen</span> n4 = <span class="fu">substr</span>(naics5,1,4)
</span>
<span id="cb3-766"><a href="#cb3-766"></a>	<span class="kw">gen</span> aa = <span class="dt">_merge</span>==1
</span>
<span id="cb3-767"><a href="#cb3-767"></a>	<span class="kw">gen</span> bb = <span class="dt">_merge</span>==2
</span>
<span id="cb3-768"><a href="#cb3-768"></a>	<span class="kw">gen</span> <span class="kw">cc</span> = aa | bb
</span>
<span id="cb3-769"><a href="#cb3-769"></a>	<span class="kw">egen</span> t0 = <span class="kw">total</span>(bb), <span class="kw">by</span>(n4 <span class="fu">year</span>)
</span>
<span id="cb3-770"><a href="#cb3-770"></a>	<span class="kw">gen</span> naicsX_old = naicsX
</span>
<span id="cb3-771"><a href="#cb3-771"></a>	<span class="kw">sort</span> naics5
</span>
<span id="cb3-772"><a href="#cb3-772"></a>	<span class="kw">replace</span> naicsX = n4+<span class="st">"XX"</span> <span class="kw">if</span> t0~=0
</span>
<span id="cb3-773"><a href="#cb3-773"></a>	<span class="kw">rename</span> <span class="dt">_merge</span> _merge5
</span>
<span id="cb3-774"><a href="#cb3-774"></a>	<span class="kw">drop</span> <span class="kw">if</span> _merge5==2
</span>
<span id="cb3-775"><a href="#cb3-775"></a>	<span class="kw">sort</span> <span class="fu">year</span> naicsX
</span>
<span id="cb3-776"><a href="#cb3-776"></a>	<span class="kw">drop</span> t0 n4 aa bb <span class="kw">cc</span> naicsX_old
</span>
<span id="cb3-777"><a href="#cb3-777"></a>	
</span>
<span id="cb3-778"><a href="#cb3-778"></a>	*Go up a <span class="dv">level</span> <span class="kw">of</span> aggregation, (look <span class="kw">for</span> <span class="fu">missing</span> N4, within N3, and
</span>
<span id="cb3-779"><a href="#cb3-779"></a>	*change naicsX to N3+<span class="st">"XXX"</span>
</span>
<span id="cb3-780"><a href="#cb3-780"></a>	<span class="kw">gen</span> naics4 = <span class="fu">substr</span>(naics,1,4)
</span>
<span id="cb3-781"><a href="#cb3-781"></a>	<span class="kw">merge</span> <span class="fu">m</span>:1 naics4 <span class="fu">year</span> <span class="kw">using</span> input/naics/naics4_year
</span>
<span id="cb3-782"><a href="#cb3-782"></a>	<span class="kw">drop</span> x 
</span>
<span id="cb3-783"><a href="#cb3-783"></a>	<span class="kw">egen</span> x = <span class="fu">tag</span>(naics4 <span class="fu">year</span>)
</span>
<span id="cb3-784"><a href="#cb3-784"></a>	<span class="kw">tab</span> _merge
</span>
<span id="cb3-785"><a href="#cb3-785"></a>	<span class="kw">table</span> <span class="fu">year</span> <span class="dt">_merge</span> <span class="kw">if</span> x, c(<span class="kw">sum</span> man)
</span>
<span id="cb3-786"><a href="#cb3-786"></a>	<span class="kw">gen</span> n3 = <span class="fu">substr</span>(naics4,1,3)
</span>
<span id="cb3-787"><a href="#cb3-787"></a>	<span class="kw">gen</span> aa = <span class="dt">_merge</span>==1
</span>
<span id="cb3-788"><a href="#cb3-788"></a>	<span class="kw">gen</span> bb = <span class="dt">_merge</span>==2
</span>
<span id="cb3-789"><a href="#cb3-789"></a>	<span class="kw">gen</span> <span class="kw">cc</span> = aa | bb
</span>
<span id="cb3-790"><a href="#cb3-790"></a>	<span class="kw">egen</span> t0 = <span class="kw">total</span>(bb), <span class="kw">by</span>(n3 <span class="fu">year</span>)
</span>
<span id="cb3-791"><a href="#cb3-791"></a>	<span class="kw">gen</span> naicsX_old = naicsX
</span>
<span id="cb3-792"><a href="#cb3-792"></a>	<span class="kw">sort</span> naics4
</span>
<span id="cb3-793"><a href="#cb3-793"></a>	<span class="kw">replace</span> naicsX = n3+<span class="st">"XXX"</span> <span class="kw">if</span> t0~=0
</span>
<span id="cb3-794"><a href="#cb3-794"></a>	<span class="kw">rename</span> <span class="dt">_merge</span> _merge4
</span>
<span id="cb3-795"><a href="#cb3-795"></a>	<span class="kw">drop</span> <span class="kw">if</span> _merge4==2
</span>
<span id="cb3-796"><a href="#cb3-796"></a>	<span class="kw">sort</span> <span class="fu">year</span> naicsX
</span>
<span id="cb3-797"><a href="#cb3-797"></a>	<span class="kw">drop</span> t0 n3 aa bb <span class="kw">cc</span> naicsX_old
</span>
<span id="cb3-798"><a href="#cb3-798"></a>	
</span>
<span id="cb3-799"><a href="#cb3-799"></a>
</span>
<span id="cb3-800"><a href="#cb3-800"></a>	*List the XXXs, XXs and Xs that are created <span class="kw">in</span> the preceding blocks
</span>
<span id="cb3-801"><a href="#cb3-801"></a>	*
</span>
<span id="cb3-802"><a href="#cb3-802"></a>	*		11119X 11133X 11141X 11251X 21211X 21223X 21231X 21232X 31131X 31135X 
</span>
<span id="cb3-803"><a href="#cb3-803"></a>	*		31141X 31161X 31171X 31199X 31311X 31322X 31324X 31331X 32121X 32191X 
</span>
<span id="cb3-804"><a href="#cb3-804"></a>	*		32222X 32223X 32311X 32312X 32531X 32541X 32599X 32629X 32733X 33142X 
</span>
<span id="cb3-805"><a href="#cb3-805"></a>	*		33151X 33152X 33211X 33231X 33261X 33299X 33311X 33331X 33351X 33391X 
</span>
<span id="cb3-806"><a href="#cb3-806"></a>	*		33411X 33461X 33512X 33522X 33611X 33631X 33699X 33712X 33721X 33911X 
</span>
<span id="cb3-807"><a href="#cb3-807"></a>	*		33993X 33999X
</span>
<span id="cb3-808"><a href="#cb3-808"></a>	*
</span>
<span id="cb3-809"><a href="#cb3-809"></a>	*		1121XX 1123XX 2111XX 3113XX 3118XX 3122XX 3133XX 3151XX 3152XX 3241XX 
</span>
<span id="cb3-810"><a href="#cb3-810"></a>	*		3261XX 3273XX 3312XX 3315XX 3327XX 5241XX
</span>
<span id="cb3-811"><a href="#cb3-811"></a>	*
</span>
<span id="cb3-812"><a href="#cb3-812"></a>	*		113XXX 114XXX 332XXX 511XXX 524XXX
</span>
<span id="cb3-813"><a href="#cb3-813"></a>	*
</span>
<span id="cb3-814"><a href="#cb3-814"></a>	*
</span>
<span id="cb3-815"><a href="#cb3-815"></a>	<span class="kw">gen</span> n=<span class="fu">strpos</span>(naicsX,<span class="st">"X"</span>)
</span>
<span id="cb3-816"><a href="#cb3-816"></a>	<span class="kw">tab</span> <span class="fu">year</span> n
</span>
<span id="cb3-817"><a href="#cb3-817"></a>	<span class="kw">tab</span> naicsX <span class="kw">if</span> n==4
</span>
<span id="cb3-818"><a href="#cb3-818"></a>	<span class="kw">tab</span> naicsX <span class="kw">if</span> n==5
</span>
<span id="cb3-819"><a href="#cb3-819"></a>	<span class="kw">tab</span> naicsX <span class="kw">if</span> n==6
</span>
<span id="cb3-820"><a href="#cb3-820"></a>	
</span>
<span id="cb3-821"><a href="#cb3-821"></a>	<span class="kw">if</span> <span class="st">"`t'"</span> == <span class="st">"m"</span> {
</span>
<span id="cb3-822"><a href="#cb3-822"></a>		<span class="kw">local</span> tt = <span class="st">"imports"</span>
</span>
<span id="cb3-823"><a href="#cb3-823"></a>	}
</span>
<span id="cb3-824"><a href="#cb3-824"></a>	<span class="kw">if</span> <span class="st">"`t'"</span> == <span class="st">"x"</span> {
</span>
<span id="cb3-825"><a href="#cb3-825"></a>		<span class="kw">local</span> tt = <span class="st">"exports"</span>
</span>
<span id="cb3-826"><a href="#cb3-826"></a>	}
</span>
<span id="cb3-827"><a href="#cb3-827"></a>	<span class="kw">keep</span> commodity <span class="fu">year</span> sic sic_matchtype naics naicsX naics_matchtype
</span>
<span id="cb3-828"><a href="#cb3-828"></a>	<span class="kw">sort</span> <span class="fu">year</span> commodity
</span>
<span id="cb3-829"><a href="#cb3-829"></a>	cd <span class="st">"$C"</span>
</span>
<span id="cb3-830"><a href="#cb3-830"></a>	<span class="kw">save</span>           hs_sic_naics_<span class="ot">`tt'</span>_89_117_20180927, replace
</span>
<span id="cb3-831"><a href="#cb3-831"></a>	<span class="kw">outsheet</span> <span class="kw">using</span> hs_sic_naics_<span class="ot">`tt'</span>_89_117_20180927.csv, replace
</span>
<span id="cb3-832"><a href="#cb3-832"></a>
</span>
<span id="cb3-833"><a href="#cb3-833"></a>}
</span>
<span id="cb3-834"><a href="#cb3-834"></a>
</span>
<span id="cb3-835"><a href="#cb3-835"></a>
</span>
<span id="cb3-836"><a href="#cb3-836"></a>
</span>
<span id="cb3-837"><a href="#cb3-837"></a>
</span>
<span id="cb3-838"><a href="#cb3-838"></a>
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="implications-for-statistical-properties" class="slide level2">
<h2>Implications for Statistical Properties</h2>
<ul>
<li>Theoretically valid cross-taxonomy transformation logic does not guaranteee the transformed data can support downstream inference or estimation.</li>
<li>In practice, the quality of the transformed data depends on the quality of the source data, the quality of the crossmap, and <strong>the degree of imputation performed on the source data</strong>.</li>
<li>Cross-taxonomy transformations are a complex imputation procedure. Unlike with missing value imputation, it is not immediately clear how to define metrics for measuring the degree of this imputation. However, the framework suggests that such a <strong>metric needs to incorporate properities of crossmaps as well as the distance between the source and transformed data</strong>.</li>
<li>Crossmaps define a class of graphs from which we can <strong>generate alternative transformations</strong> for a given set of source observations. These alternative transformations can then be applied to <strong>examine the robustness</strong> of downstream analysis to different pre-processing (i.e.&nbsp;mapping) decisions.</li>
</ul>
</section>
<section id="other-related-work" class="slide level2">
<h2>Other related work</h2>
<ul>
<li><code>{xmap}</code> R package implementation of object classes and functions for the crossmap approach</li>
<li>Data provenance documentation:
<ul>
<li>Multi-layer graph visualisation of sequential transformations</li>
<li>Identification and summary of influential sub-graphs (i.e.&nbsp;one-to-many links are more subjective than one-to-one)</li>
<li>Extracting transformation logic from existing algorithms (i.e.&nbsp;using unit vectors to trace the distribution of values)</li>
</ul></li>
</ul>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<img src="_extensions/numbats/monash/images/monash-one-line-black-rgb.png" class="slide-logo r-stretch"><div class="footer footer-default">
<p>Monash EBS PhD Contest at IDWSDS 2023</p>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-blockerPotentialPerilsPreprocessing2013" class="csl-entry" role="listitem">
Blocker, Alexander W., and Xiao-Li Meng. 2013. <span>“The Potential and Perils of Preprocessing: Building New Foundations.”</span> <em>Bernoulli</em> 19 (4). <a href="https://doi.org/10.3150/13-BEJSP16">https://doi.org/10.3150/13-BEJSP16</a>.
</div>
<div id="ref-ehlingHarmonisingDataOfficial2003" class="csl-entry" role="listitem">
Ehling, Manfred. 2003. <span>“Harmonising <span>Data</span> in <span>Official Statistics</span>.”</span> In <em>Advances in <span>Cross-National Comparison</span></em>, edited by Jürgen H. P. Hoffmeyer-Zlotnik and Christof Wolf, 17–31. <span>Boston, MA</span>: <span>Springer US</span>. <a href="https://doi.org/10.1007/978-1-4419-9186-7_2">https://doi.org/10.1007/978-1-4419-9186-7_2</a>.
</div>
<div id="ref-fortierMaelstromResearchguidelines2016" class="csl-entry" role="listitem">
Fortier, Isabel, Parminder Raina, Edwin R Van Den Heuvel, Lauren E Griffith, Camille Craig, Matilda Saliba, Dany Doiron, et al. 2016. <span>“Maelstrom <span>Research</span> Guidelines for Rigorous Retrospective Data Harmonization.”</span> <em>International Journal of Epidemiology</em>, June, dyw075. <a href="https://doi.org/10.1093/ije/dyw075">https://doi.org/10.1093/ije/dyw075</a>.
</div>
<div id="ref-kandelWranglerInteractivevisual2011" class="csl-entry" role="listitem">
Kandel, Sean, Andreas Paepcke, Joseph Hellerstein, and Jeffrey Heer. 2011. <span>“Wrangler: Interactive Visual Specification of Data Transformation Scripts.”</span> In <em>Proceedings of the <span>SIGCHI Conference</span> on <span>Human Factors</span> in <span>Computing Systems</span></em>, 3363–72. <span>Vancouver BC Canada</span>: <span>ACM</span>. <a href="https://doi.org/10.1145/1978942.1979444">https://doi.org/10.1145/1978942.1979444</a>.
</div>
<div id="ref-kolczynska2022" class="csl-entry" role="listitem">
Kołczyńska, Marta. 2022. <span>“Combining Multiple Survey Sources: A Reproducible Workflow and Toolbox for Survey Data Harmonization.”</span> <em>Methodological Innovations</em> 15 (1): 62–72. <a href="https://doi.org/10.1177/20597991221077923">https://doi.org/10.1177/20597991221077923</a>.
</div>
<div id="ref-wickhamTidyData2014" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (10). <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="slides_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="slides_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="slides_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="slides_files/libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="slides_files/libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="slides_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="slides_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="slides_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="slides_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="slides_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'multiplex': {"secret":"16969015695473999677","id":"649f55018c3d9569","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: 90,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <link rel="stylesheet" href="assets/syntax-highlight.css">
    <link rel="stylesheet" href="assets/monash-after-body.css">
    <link rel="stylesheet" href="assets/fontawesome-free-6.1.1-web/css/all.min.css">
    <script src="assets/fontawesome-free-6.1.1-web/js/all.min.js"></script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>